!function(){"use strict";function t(t,e,o,n,r,i,a,s,c){t.username="",t.password="",t.touchSignin=function(){var e=t.username,o=t.password;!e||e.length<3?t.toast("用户名太短"):!e||e.length>25?t.toast("用户名太长"):!o||o.length<4?t.toast("请输入正确的密码"):a.auth.base.signin({username:e,password:o}).then(function(e){e?(t.toast("登录成功"),t.goHome()):t.toast("用户名或密码错误")})},t.touchSignup=function(){r.go("signup",{})},t.touchForget=function(){r.go("forget",{})},t.touchWeixin=function(){r.go("wechat-auth",{})},t.touchQQ=function(){r.go("qq-auth",{})},t.isWeixin=function(){var t=c.getConfig();return!!t&&t["wechat.web"]&&i.isWeixin()}}angular.module("app").controller("SigninController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("signin",{needAuth:!1,url:"/signin",title:"用户登录",templateUrl:"modules/signin/signin.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){function l(){var e=60,o=void 0;o=u(function(){e<=0?(u.cancel(o),o=void 0,e=60,t.paracont="重发验证码",t.paraclass="mobile-code",t.paraevent=!0):(t.paracont=e+"s",t.paraclass="not-mobile-code",t.paraevent=!1,e--)},1e3,100)}t.TAB_MOBILE=0,t.TAB_EMAIL=1,t.currentTab=t.TAB_MOBILE,"mobile"==i.tab?t.currentTab=t.TAB_MOBILE:"email"==i.tab?t.currentTab=t.TAB_EMAIL:t.currentTab=t.TAB_MOBILE,t.touchTabMobile=function(){t.currentTab!=t.TAB_MOBILE&&(t.currentTab=t.TAB_MOBILE,t.signupMobile={show:!0})},t.touchTabEmail=function(){t.currentTab!=t.TAB_EMAIL&&(t.currentTab=t.TAB_EMAIL,t.signupMobile={show:!1})},t.signupMobile={show:!0},t.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},t.touchSignup=function(){var e=t.state.username,o=t.state.password,n=t.state.password2,r=t.state.email;if(!e||e.length<3)t.toast("用户名太短");else if(!e||e.length>25)t.toast("用户名太长");else if(!o||o.length<6)t.toast("请输入正确的密码");else{if(o!=n)return t.toast("请输入正确的密码"),void(t.password2="");if(!r||r.length<5)t.toast("请输入正确的邮箱地址");else{var i={};i.username=e,i.password=o,i.email=r,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),a.auth.default.signup(i).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?(t.toast("注册成功"),t.goHome()):t.toast(e.data.error_desc)})}}},t.touchSignupMobile=function(){var e=t.state.mobile,o=t.state.mobile_code,n=t.state.mobile_password,r=t.state.mobile_password2;if(!e||e.length<1)t.toast("请输入手机号码");else if(o&&6==o.length)if(!n||n.length<6)t.toast("请输入正确的密码");else{if(n!=r)return t.toast("请输入正确的密码"),void(t.password2="");var i={};i.mobile=e,i.code=o,i.password=n,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),a.auth.mobile.signup(i).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?(t.toast("手机号注册成功"),t.goHome()):t.toast(e.data.error_desc)})}else t.toast("请输入正确的手机验证码")},t.toucheMobileCode=function(){if(t.paraevent){var e=t.state.mobile;if(!e||e.length<1)t.toast("请输入手机号码");else{var o={};o.mobile=e,o.code="86",a.auth.mobile.verify(o).then(function(e){e&&a.auth.mobile.send(o).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?l():t.toast(e.data.error_desc)})})}}},t.touchLicense=function(){o.location.href=t.siteInfo.terms_url},t.siteInfo={},t.paracont="获取验证码",t.paraclass="mobile-code",t.paraevent=!0,a.site.get().then(function(e){t.siteInfo=e})}angular.module("app").controller("SignupController",t),t.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function t(t,e){t.state("signup",{needAuth:!1,url:"/signup",title:"用户注册",templateUrl:"modules/signup/signup.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){function l(){var e=60,o=void 0;o=u(function(){e<=0?(u.cancel(o),o=void 0,e=60,t.paracont="重发验证码",t.paraclass="mobile-code",t.paraevent=!0):(t.paracont=e+"s",t.paraclass="not-mobile-code",t.paraevent=!1,e--)},1e3,100)}t.TAB_MOBILE=0,t.TAB_EMAIL=1,t.currentTab=t.TAB_MOBILE,"mobile"==i.tab?t.currentTab=t.TAB_MOBILE:"email"==i.tab?t.currentTab=t.TAB_EMAIL:t.currentTab=t.TAB_MOBILE,t.touchTabMobile=function(){t.currentTab!=t.TAB_MOBILE&&(t.currentTab=t.TAB_MOBILE,t.forgetMobile={show:!0})},t.touchTabEmail=function(){t.currentTab!=t.TAB_EMAIL&&(t.currentTab=t.TAB_EMAIL,t.forgetMobile={show:!1})},t.toucheMobileCode=function(){if(t.paraevent){var e=t.state.mobile;if(!e||e.length<1)t.toast("请输入手机号码");else{var o={};o.mobile=e,o.code="86",a.auth.mobile.send(o).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?l():t.toast(e.data.error_desc)})}}},t.touchforgetMobile=function(){var e=t.state.mobile,o=t.state.mobile_code,n=t.state.mobile_password,r=t.state.mobile_password2;if(!e||e.length<1)t.toast("请输入手机号码");else if(o&&6==o.length)if(!n||n.length<6)t.toast("请输入正确的密码");else{if(n!=r)return t.toast("请输入正确的密码"),void(t.password2="");var i={};i.mobile=e,i.code=o,i.password=n,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),a.auth.mobile.reset(i).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?(t.toast("找回密码成功"),t.goBack()):t.toast(e.data.error_desc)})}else t.toast("请输入正确的手机验证码")},t.touchBackLogin=function(){t.goBack()},t.forgetMobile={show:!0},t.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},t.paracont="获取验证码",t.paraclass="mobile-code",t.paraevent=!0,t.success=!1,t.email="",t.input={email:""},t.touchSendMail=function(){var e=t.input.email;!e||e.length<4?t.toast("请输入正确的邮箱"):a.auth.default.reset({email:e}).then(function(o){var n=s.ERROR_CODE.OK==o.data.error_code;t.success=n,n?t.email=e:t.toast(o.data.error_desc)})}}angular.module("app").controller("ForgetController",t),t.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function t(t,e){t.state("forget",{needAuth:!1,url:"/forget",title:"找回密码",templateUrl:"modules/forget/forget.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l,d,p){function h(){a.banner.list({page:1,per_page:$}).then(function(e){t.banners=e;n(function(){t.bannerSwiper=new Swiper(".home-banner",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)})}function f(){a.notice.list({page:1,per_page:A}).then(function(e){t.notices=e;n(function(){t.noticeSwiper=new Swiper(".notice-slide",{spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,direction:"vertical",loop:!0})},1)})}function g(){a.product.homeList().then(function(e){t.editorChoice=e.good_products,t.newArrival=e.recently_products,t.topSale=e.hot_products})}function m(){l.getSiteName()?u.document.title=l.getSiteName():(y(),u.document.title="ECShop"),h(),f(),g(),p.fetch(),l.getToken()&&a.bonus.get().then(function(e){if(t.bonus_info=e,t.wechatConfig&&t.bonus_info){var o=t.wechatConfig["wechat.web"];o&&v(o,t.bonus_info.shared_link)}return!0}),p.fetchWeChat().then(function(e){if(t.wechatConfig=e,e){var n=e["wechat.web"];if(n&&c.FOR_WEIXIN&&!l.getOpenId()){if(o.isWeixin())return void i.go("wechat-authbase",{})}else l.getToken()?t.wechatConfig&&t.bonus_info&&(n=t.wechatConfig["wechat.web"])&&v(n,t.bonus_info.shared_link):(n=t.wechatConfig["wechat.web"])&&v(n,u.location.protocol+"//"+u.location.host+u.location.pathname)}return!0}),t.cartModel.reloadIfNeeded()}function v(t,e){if(t){wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:t.app_id,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareWeibo","onMenuShareQQ"]});var n=e;wx.ready(function(){console.log("微信分享设置Ready");var t={title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){console.log("success".JSON.stringify(t))},cancel:function(){}};console.log(t),wx.onMenuShareTimeline(t),wx.onMenuShareAppMessage(t),wx.onMenuShareQQ(t),wx.onMenuShareWeibo(t)}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&(console.log(JSON.stringify(t)),o.toast(JSON.stringify(t)))})}}function y(){a.site.get().then(function(e){t.siteInfoName=e.name,t.siteInfoName&&l.setSiteName(t.siteInfoName)})}var $=10,A=5,T=4;t.banners=[],t.notices=[];var S={},E=[];t.wechatConfig=null,t.bonus_info=null;for(var _=0;_<T;++_)E.push(S);t.topSale=E,t.newArrival=E,t.editorChoice=E,t.touchSearch=function(){i.go("search",{})},t.touchBanner=function(e){e.link&&e.link.length?u.location.href=e.link:t.toast("没有链接")},t.touchNotice=function(t){var e="";e=-1==t.url.indexOf("http://",0)?"http://"+t.url:t.url,u.location.href=e},t.touchCategory=function(t){i.go("search-result",{sortKey:s.SORT_KEY.DEFAULT,sortValue:s.SORT_VALUE.DEFAULT,keyword:null,category:t.id,navTitle:t.name,navStyle:"default"})},t.touchProduct=function(t){i.go("product",{product:t.id})},t.touchGroup=function(t){i.go("home",{})},t.formatUrl=function(t){var e=Math.round((new Date).getTime()/1e3);return-1==t.indexOf("?")?t+"?v="+e:t+"&v="+e},t.reload=m,t.loadMore=function(){},t.cartModel=d,t.refreshCode=function(){Math.round((new Date).getTime()/1e3)},m()}angular.module("app").controller("HomeController",t),t.$inject=["$scope","$http","$rootScope","$timeout","$location","$state","API","ENUM","CONSTANTS","$window","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("index",{needAuth:!1,url:"?token",title:"",templateUrl:"modules/home/home.html"}),t.state("home",{needAuth:!1,url:"/home",title:"",templateUrl:"modules/home/home.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a){function s(){r.category.list({page:1,per_page:c}).then(function(e){e&&e.length?(t.categories=e,t.selectedSide=e[0],t.subCategories=e[0].categories):(t.categories=null,t.selectedSide=null,t.subCategories=null)})}var c=1e3;t.categories=[],t.selectedSide=null,t.touchSearch=function(){n.go("search",{})},t.touchSide=function(e){t.selectedSide=e,t.subCategories=e.categories},t.touchMain=function(e){if(e)n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:e.id,title:e.name,navTitle:e.name,navStyle:"default"});else{var o=t.selectedSide;n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:o.id,navTitle:o.name,title:o.name,navStyle:"default"})}},t.cartModel=a,s()}angular.module("app").controller("CategoryController",t),t.$inject=["$scope","$http","$location","$state","API","ENUM","CartModel"]}(),function(){"use strict";function t(t,e){t.state("category",{needAuth:!1,url:"/category",title:"商品分类",templateUrl:"modules/category/category.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.isEmpty=!1,c.isLoaded=!1,c.isLoading=!1,c.isLastPage=!1,c.total=0,c.subtotal={},c.groups=null,c.count=function(){var t=0;if(this.groups)for(var e=this.groups,o=0;o<e.length;++o)for(var n=e[o],r=0;r<n.goods.length;++r)t+=Number(n.goods[r].amount);this.total=t},c.add=function(t,e,o){if(i.getToken()){var n=this;return a.cart.add({product:t,property:JSON.stringify(e),amount:o}).then(function(t){return t&&n.reload(),t})}},c.delete=function(t){if(i.getToken()){var e=this;return a.cart.delete({good:t}).then(function(o){if(o){for(var n=e.groups,r=0;r<n.length;++r)for(var i=n[r],a=0;a<i.goods.length;++a)if(i.goods[a].id==t){i.goods.splice(a,1);break}e.isEmpty=!e.groups||!e.groups.length,e.count()}return o})}},c.update=function(t,e){if(i.getToken()){var o=this;return a.cart.update({good:t,amount:e}).then(function(n){if(n){for(var r=o.groups,i=0;i<r.length;++i)for(var a=r[i],s=0;s<a.goods.length;++s){var c=a.goods[s];if(c.id==t){c.amount=e;break}}o.isEmpty=!o.groups||!o.groups.length,o.count()}return n})}},c.reload=function(){if(!i.getToken())return this.total=0,void(c.total=0);var t=this;return a.cart.get({}).then(function(e){return e&&(t.groups=e,t.isEmpty=!t.groups||!t.groups.length,t.isLoaded=!0,t.isLoading=!1,t.count()),a.order.subtotal().then(function(e){t.subtotal=e}),!!e})},c.reloadIfNeeded=function(){this.reload()},c}angular.module("app").factory("CartModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i){function a(){for(var e=0,o=0,n=t.selectedGoods,r=0;r<n.length;++r)e+=Number(n[r].amount),o+=n[r].amount*n[r].price;t.selectedAmount=e,t.selectedPrice=o}t.showDialog=!1,t.deletingGoods=null,t.touchDelete=function(e){t.deletingGoods=e,t.showDialog=!0},t.touchDialogCancel=function(){t.showDialog=!1,t.deletingGoods=null},t.touchDialogConfirm=function(){t.deletingGoods&&t.cartModel.delete(t.deletingGoods.id).then(function(e){if(e){for(var o=t.selectedGoods,n=0;n<o.length;++n)if(o[n].id==t.deletingGoods.id){o.splice(n,1);break}t.toast("删除成功"),t.showDialog=!1,t.deletingGoods=null,a()}})},t.touchProduct=function(t){n.go("product",{product:t.id})},t.touchSubmit=function(){t.selectedGoods&&t.selectedGoods.length?(r.clear(),r.goods=t.selectedGoods,n.go("confirm-cart",{})):t.toast("请先选择商品")},t.touchAmountSub=function(e){e.amount<=1||t.cartModel.update(e.id,Number(e.amount)-1).then(function(t){a()})},t.touchAmountAdd=function(e){t.cartModel.update(e.id,Number(e.amount)+1).then(function(t){a()})},t.touchSelect=function(e){for(var o=t.selectedGoods,n=-1,r=0;r<o.length;++r)if(o[r].id==e.id){n=r;break}-1==n?o.push(e):o.splice(n,1),a()},t.touchSelectAll=function(){var e=t.cartModel.groups,o=[],n=!t.isSelectedAll;if(n)for(var r=0;r<e.length;++r)for(var i=e[r],s=0;s<i.goods.length;++s){var c=i.goods[s];o.push(c)}t.selectedGoods=o,t.isSelectedAll=n,a()},t.isSelected=function(e){for(var o=t.selectedGoods,n=0;n<o.length;++n)if(e.id==o[n].id)return!0;return!1},t.isSelectedAll=!1,t.selectedGoods=[],t.selectedAmount=0,t.selectedPrice=0,t.cartModel=i,t.cartModel.reload()}angular.module("app").controller("CartController",t),t.$inject=["$scope","$http","$location","$state","ConfirmCartService","CartModel"]}(),function(){"use strict";function t(t,e){t.state("cart",{needAuth:!0,url:"/cart",title:"购物车",templateUrl:"modules/cart/cart.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e){t.state("cart-select",{needAuth:!0,url:"/cart-select",title:"购物车",templateUrl:"modules/cart-select/cart-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){function u(){l()&&i.user.profileGet().then(function(e){a.setUser(e),t.user=e,e.nickname?t.userName=e.nickname:t.userName=e.username})}function l(){return a.getToken()}t.touchAllOrders=function(){r.go("my-order",{tab:"all"})},t.touchOrderCreated=function(){r.go("my-order",{tab:"created"})},t.touchOrderPayed=function(){r.go("my-order",{tab:"paid"})},t.touchOrderDelivering=function(){r.go("my-order",{tab:"delivering"})},t.touchOrderDelivered=function(){r.go("my-order",{tab:"delivered"})},t.touchFav=function(){r.go("my-favorite",{})},t.touchAddress=function(){r.go("my-address",{})},t.touchScore=function(){r.go("my-score",{tab:"all"})},t.touchCashGift=function(){r.go("my-cashgift",{})},t.touchHelps=function(){r.go("article",{})},t.touchPassword=function(){r.go("change-password",{})},t.touchSignin=function(){a.getToken()||t.goSignin()},t.touchSignout=function(){a.getToken()&&i.auth.base.signout().then(function(e){e?(t.goHome(),t.toast("注销成功")):t.toast("注销失败")})},t.touchBonus=function(){r.go("bonus",{})},t.touchBalance=function(){r.go("my-balance",{})},t.isSignIn=l,t.isWeixin=function(){return o.isWeixin()},t.cartModel=s,t.user=a.getUser(),t.userName="",c.fetch();var d=c.getConfig();t.authorize=d.authorize,u(),t.cartModel.reloadIfNeeded()}angular.module("app").controller("ProfileController",t),t.$inject=["$scope","$http","$rootScope","$location","$state","API","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("profile",{needAuth:!0,url:"/profile",title:"个人中心",templateUrl:"modules/profile/profile.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a={};return a.history=null,a.clear=function(){this.history=null},i.$on("searchChanged",function(t,e){e&&e.length&&-1==(a.history?a.history.indexOf(e):-1)&&(a.history=a.history||[],a.history.push(e))}),a}angular.module("app").factory("SearchService",t),t.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){function u(){a.search.keywordList({}).then(function(e){t.keywords=e})}t.currentKeyword="",t.keywords=null,t.history=c.history,t.touchSearch=function(){!t.currentKeyword||t.currentKeyword.length<1?t.toast("请输入正确的关键字"):(r.$emit("searchChanged",t.currentKeyword),i.go("search-result",{sortKey:s.SORT_KEY.DEFAULT,sortValue:s.SORT_VALUE.DEFAULT,keyword:t.currentKeyword,category:null,navTitle:t.currentKeyword,navStyle:"search"}))},t.touchKeyword=function(e){!e||e.length<1?t.toast("请输入正确的关键字"):(t.currentKeyword=e,r.$emit("searchChanged",e),i.go("search-result",{sortKey:s.SORT_KEY.DEFAULT,sortValue:s.SORT_VALUE.DEFAULT,keyword:e,category:null,navTitle:e,navStyle:"search"}))},u()}angular.module("app").controller("SearchController",t),t.$inject=["$scope","$http","$window","$timeout","$rootScope","$state","API","ENUM","SearchService"]}(),function(){"use strict";function t(t,e){t.state("search",{needAuth:!1,url:"/search",title:"搜索",templateUrl:"modules/search/search.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){function l(){t.isLoading||(t.products=null,t.isEmpty=!1,t.isLoaded=!1,d(1,p))}function d(e,o){t.isLoading=!0;var n={};t.currentCategory&&(n.category=t.currentCategory),t.currentKeyword&&(n.keyword=t.currentKeyword),n.sort_key=t.currentSortKey,n.sort_value=t.currentSortValue,n.page=e,n.per_page=o,c.product.list(n).then(function(e){t.products=t.products?t.products.concat(e):e,t.isEmpty=!t.products||!t.products.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=!!(e&&e.length<o)&&!t.isEmpty})}var p=10;t.currentSortKey=s.sortKey?s.sortKey:u.SORT_KEY.DEFAULT,t.currentSortValue=s.sortValue?s.sortValue:u.SORT_KEY.DESC,t.currentKeyword=s.keyword?s.keyword:null,t.currentCategory=s.category,t.navTitle=s.navTitle,t.navStyle=s.navStyle,t.navStyle||(t.navStyle="default"),t.products=null,t.touchSearch=function(){l()},t.touchSortDefault=function(){var e=u.SORT_KEY.DEFAULT,o=u.SORT_VALUE.DEFAULT;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,l())},t.touchSortSale=function(){var e=u.SORT_KEY.SALE,o=u.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,l())},t.touchSortDate=function(){var e=u.SORT_KEY.DATE,o=u.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,l())},t.touchSortPrice=function(){var e=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC;t.currentSortKey==u.SORT_KEY.PRICE?t.currentSortValue==u.SORT_VALUE.DEFAULT||t.currentSortValue==u.SORT_VALUE.ASC?(e=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC):(e=u.SORT_KEY.PRICE,o=u.SORT_VALUE.ASC):(e=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC),e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,l())},t.touchSortCredit=function(){var e=u.SORT_KEY.CREDIT,o=u.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,l())},t.touchProduct=function(t){a.go("product",{product:t.id})},t.loadMore=function(){if(!t.isLoading&&!t.isLastPage)if(t.products&&t.products.length){if(t.products.length%10)return;d(t.products.length/p+1,p)}else d(1,p)},t.isEmpty=!1,t.isLoaded=!1,t.isLoading=!1,t.isLastPage=!1,r.height&&$("html, body").animate({scrollTop:r.height},500),l()}angular.module("app").controller("SearchResultController",t),t.$inject=["$scope","$http","$window","$timeout","SearchResultModel","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("search-result",{needAuth:!1,url:"/search-result/?keyword&sortKey&sortValue&category&navTitle&navStyle",title:"搜索结果",templateUrl:"modules/search-result/search-result.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.height=0,c.products=[],c}angular.module("app").factory("SearchResultModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l,d,p,h){function f(){var e=[].concat(t.currentAttrs).concat(t.optionalAttrs);t.currentSelectedPrice=parseFloat(t.product.current_price);for(var o=0;o<t.product.properties.length;++o){var n=t.product.properties[o];for(var r in n.attrs)-1!=e.indexOf(n.attrs[r].id)&&n.attrs[r].attr_price&&(t.currentSelectedPrice+=parseFloat(n.attrs[r].attr_price))}}function g(){var e=t.product,o=!1;if(!e||!e.good_stock)return!1;for(var n in e.properties)if(!e.properties[n].is_multiselect){o=!0;break}if(o){if(!t.currentAttrs||!t.currentAttrs.length)return!1;if(!m([].concat(t.currentAttrs)))return!1;if(!t.currentStock)return!1}return!0}function m(e){for(var o=0;o<t.product.stock.length;o++){var n=t.product.stock[o],r=n.goods_attr.split("|");r.sort(function(t,e){return t-e});for(var i=0;i<e.length;i++){var a=e[i];e[i]=a.toString()}if(e.sort(function(t,e){return t-e}),v(r,e)&&n.stock_number>0)return!0}return!1}function v(t,e){if(t.length<e.length)return!1;for(var o=0,n=e.length;o<n;o++)if(-1==t.indexOf(e[o]))return!1;return!0}function y(){t.isLoading=!0,c.product.get({product:S}).then(function(e){if(e.properties.sort(function(t,e){return t.is_multiselect-e.is_multiselect}),t.product=e,t.isLoaded=!0,t.isLoading=!1,t.canPurchase=g(),h.fetchWeChat().then(function(e){if(e){var o=e["wechat.web"];o&&$(o,t.product)}}),e.photos&&e.photos.length>1)r(function(){t.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1);else r(function(){t.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!1,spaceBetween:30,centeredSlides:!0,autoplay:0,autoplayDisableOnInteraction:!1,loop:!1})},1);for(var o=[],n=null,i=0;i<e.stock.length;i++){var a=e.stock[i];if(a.stock_number>0){for(var s=a.goods_attr.split("|"),i=0;i<s.length;i++){var c=s[i];o.push(parseInt(c))}o.sort(function(t,e){return t-e});break}}if(o.length)for(var u=o.join("|"),i=0;i<e.stock.length;++i){var l=e.stock[i].goods_attr.split("|");if(l.sort(function(t,e){return t-e}),l.join("|")==u){n=e.stock[i];break}}t.currentAttrs=o,t.currentStock=n,t.canPurchase=g(),f(),A()})}function $(t,o){if(t){var n=o.share_url?o.share_url:o.share_link;wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:t.app_id,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:"商品详情",desc:o.name,link:n,imgUrl:o.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"商品详情",desc:o.name,link:n,imgUrl:o.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"商品详情",desc:o.name,link:n,imgUrl:o.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"商品详情",desc:o.name,link:n,imgUrl:o.default_photo.large,success:function(){},cancel:function(){}})}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&e.toast(JSON.stringify(t))})}}function A(){t.product&&c.review.productList({product:S,grade:u.REVIEW_GRADE.ALL,page:1,per_page:T}).then(function(e){t.comments=e})}var T=3,S=s.product;t.currentStock=null,t.currentAttrs=[],t.currentSelectedPrice=0,t.input={currentAmount:1},t.optionalAttrs=[],t.canPurchase=!1,t.product=null,t.comments=[],t.cartModel=p,t.touchAmountSub=function(){if(g()&&t.product&&(!t.product.stock||!t.product.stock.length||t.currentStock)){var e=parseInt(t.input.currentAmount);e<=1?t.toast("受不了了，宝贝不能再少了"):t.input.currentAmount=e-1}},t.touchAmountAdd=function(){if(g()&&t.product)if(t.product.stock&&t.product.stock.length){if(!t.currentStock)return;if((e=parseInt(t.input.currentAmount))>=(o=parseInt(t.currentStock.stock_number)))return void t.toast("达到最大库存");t.input.currentAmount=e+1}else{var e=parseInt(t.input.currentAmount),o=t.product.good_stock;if(e>=o)return;t.input.currentAmount=e+1}},t.touchAttr=function(e,o){if(t.product){var n=t.product;if(o.is_multiselect)-1==(a=(i=[].concat(t.optionalAttrs)).indexOf(o.id))?i.push(o.id):i.splice(a,1),t.optionalAttrs=i,f();else{var r=null,i=[].concat(t.currentAttrs),a=i.indexOf(o.id);for(var s in e.attrs)e.attrs[s].id!=o.id&&-1!=(a=i.indexOf(e.attrs[s].id))&&i.splice(a,1);if(i.push(o.id),(i=i.filter(function(t,e,o){return o.indexOf(t)===e})).sort(function(t,e){return t-e}),i.length)for(var c=i.join("|"),s=0;s<n.stock.length;++s){var u=n.stock[s].goods_attr.split("|");if(u.sort(function(t,e){return t-e}),u.join("|")==c){r=n.stock[s];break}}t.currentAttrs=i,t.currentStock=r,t.canPurchase=g(),f()}}},t.touchLike=function(){l.getToken()?t.product.is_liked?(t.product.is_liked=!1,c.product.unlike({product:S}).then(function(e){t.product.is_liked=e,t.toast("取消收藏")},function(e){t.product.is_liked=!0})):(t.product.is_liked=!0,c.product.like({product:S}).then(function(e){t.product.is_liked=e,t.toast("收藏成功")},function(e){t.product.is_liked=!1})):t.goSignin()},t.touchComments=function(){a.go("comment",{product:S})},t.touchComment=function(t){a.go("comment",{product:S})},t.touchCart=function(){l.getToken()?a.go("cart-select",{}):t.goSignin()},t.touchAddCart=function(){if(g())if(l.getToken()){var e=[].concat(t.currentAttrs).concat(t.optionalAttrs),o=Number(t.input.currentAmount);p.add(S,e,o).then(function(e){e&&t.toast("已添加到购物车")})}else t.goSignin()},t.touchPurchase=function(){if(g())if(l.getToken()){var e=t.product,o=[].concat(t.currentAttrs).concat(t.optionalAttrs),n=Number(t.input.currentAmount);d.clear(),d.product=e,d.attrs=o,d.amount=n,a.go("confirm-product",{})}else t.goSignin()},t.refreshAmount=function(){var e=parseInt(t.input.currentAmount),o=parseInt(t.currentStock.stock_number);e>o&&(t.toast("达到最大库存"),t.input.currentAmount=o),e<1&&(t.input.currentAmount=1)},t.touchPromo=function(){a.go("activity",{})},t.formatGrade=function(t){return u.REVIEW_GRADE.BAD==t?"差评":u.REVIEW_GRADE.MEDIUM==t?"中评":u.REVIEW_GRADE.GOOD==t?"好评":"中评"},t.isAttrSelected=function(e){return e.is_multiselect?-1==t.optionalAttrs.indexOf(e.id)?"unSelected":"selected":-1==t.currentAttrs.indexOf(e.id)?"unSelected":"selected"},t.isLoading=!1,t.isLoaded=!1,t.touchGoHome=function(){e.goHome()},y()}angular.module("app").controller("ProductController",t),t.$inject=["$scope","$rootScope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","ConfirmProductService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("product",{needAuth:!1,url:"/product?product",title:"商品详情",templateUrl:"modules/product/product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){function u(e,o){var n=c.REVIEW_GRADE.ALL;t.currentTab==t.TAB_ALL?n=c.REVIEW_GRADE.ALL:t.currentTab==t.TAB_BAD?n=c.REVIEW_GRADE.BAD:t.currentTab==t.TAB_MEDIUM?n=c.REVIEW_GRADE.MEDIUM:t.currentTab==t.TAB_GOOD&&(n=c.REVIEW_GRADE.GOOD),t.isLoading=!0,s.review.productList({product:p,grade:n,page:e,per_page:o}).then(function(e){t.comments=t.comments?t.comments.concat(e):e,t.isEmpty=!t.comments||!t.comments.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=!!(e&&e.length<o)&&!t.isEmpty})}function l(){t.isLoading||(t.comments=null,t.isEmpty=!1,t.isLoaded=!1,u(1,d))}var d=10,p=a.product;t.TAB_ALL=0,t.TAB_BAD=1,t.TAB_MEDIUM=2,t.TAB_GOOD=3,t.currentPage=0,t.currentTab=t.TAB_ALL,t.comments=null,t.touchTabAll=function(){t.currentTab=t.TAB_ALL,l()},t.touchTabBad=function(){t.currentTab=t.TAB_BAD,l()},t.touchTabMedium=function(){t.currentTab=t.TAB_MEDIUM,l()},t.touchTabGood=function(){t.currentTab=t.TAB_GOOD,l()},t.loadMore=function(){t.isLoading||t.isLastPage||(t.comments&&t.comments.length?u(t.comments.length/d+1,d):u(1,d))},t.formatGrade=function(t){return c.REVIEW_GRADE.BAD==t?"差评":c.REVIEW_GRADE.MEDIUM==t?"中评":c.REVIEW_GRADE.GOOD==t?"好评":"中评"},t.isEmpty=!1,t.isLoaded=!1,t.isLoading=!1,t.isLastPage=!1,l()}angular.module("app").controller("CommentController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("comment",{needAuth:!1,url:"/comment/?product",title:"商品评价",templateUrl:"modules/comment/comment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a={};return a.goods=[],a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.express=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.clear=function(){this.goods=[],this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},a.input={score:0,comment:""},n.$on("consigneeChanged",function(t,e){a.consignee=e}),n.$on("expressChanged",function(t,e){a.express=e}),n.$on("invoiceChanged",function(t,e){a.invoiceTitle=e.title,a.invoiceType=e.type,a.invoiceContent=e.content}),n.$on("cashgiftChanged",function(t,e){a.cashgift=e}),a}angular.module("app").factory("ConfirmCartService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l,d,p){function h(){var e={};s.consignee.list(e).then(function(e){if(e&&(t.consigneeList=e,!t.consignee))for(var o in t.consigneeList)t.consigneeList[o].is_default&&(t.consignee=t.consigneeList[o],r.$emit("consigneeChanged",t.consignee))})}function f(){t.maxUseScore=0;for(var e=0;e<t.goods.length;++e)t.maxUseScore+=t.goods[e].product.score*t.goods[e].amount;s.score.get({}).then(function(e){t.scoreInfo=e,t.refreshScore()})}function g(){var e=t.goods,o=t.consignee,n=t.express,r=t.coupon,i=t.cashgift,a=t.input.score;if(e&&e.length){if(o){for(var c=[],u=0;u<e.length;++u)c.push({goods_id:e[u].product.id,property:e[u].attrs.split(","),num:e[u].amount});var l={};l.order_product=JSON.stringify(c),o&&(l.consignee=o.id),n&&(l.shipping=n.id),i&&(l.cashgift=i.id),r&&(l.coupon=r.id),a&&(l.score=a),s.order.price(l).then(function(e){t.priceInfo=e,t.all_discount=parseFloat(e.discount_price);for(var o=0;o<e.promos.length;++o){var n=e.promos[o];t.all_discount+=parseFloat(n.price)}})}}else t.toast("商品信息不存在")}u.goods&&u.goods.length?(t.touchAddress=function(){n.go("address-select",{address:t.consignee?t.consignee.id:null})},t.touchExpress=function(){if(t.consignee){for(var e=t.goods,o=[],r=[],i=[],a=0;a<e.length;++a)o.push(e[a].product.id),r.push(e[a].amount),i.push(e[a].attrs.split(","));l.clear(),l.expressId=t.express?t.express.id:null,l.goodsIds=o,l.goodsNumbers=r,l.region=t.consignee.id,l.propertys=i,n.go("express-select",{})}else t.toast("请选择地址")},t.touchInvoice=function(){d.clear(),d.type=t.invoiceType?t.invoiceType:null,d.title=t.invoiceTitle,d.content=t.invoiceContent?t.invoiceContent:null,n.go("invoice-select",{})},t.touchCashgift=function(){var e=t.goods,o=(t.consignee,t.express,t.cashgift),r=0;for(var i in e)r+=e[i].price;n.go("cashgift-select",{cashgift:o?o.id:null,total:r})},t.touchSubmit=function(){var e=t.goods,o=t.consignee,r=t.express,i=t.coupon,a=t.cashgift,c=t.input.score,d=t.input.comment,h=t.invoiceType,f=t.invoiceTitle,g=t.invoiceContent,m=[];if(e&&e.length){for(var v=0;v<e.length;++v)m.push(e[v].id);if(m&&m.length)if(o)if(r){var y={shop:1,consignee:o?o.id:null,cart_good_id:m?JSON.stringify(m):null,shipping:r?r.id:null,invoice_type:h?h.name:null,invoice_title:f,invoice_content:g?g.name:null,coupon:i?i.id:null,cashgift:a?a.id:null,score:c,comment:d};s.cart.checkout(y).then(function(t){t&&(u.clear(),l.clear(),p.clear(),p.order=t,n.go("payment",{order:t.id}))})}else t.toast("请选择快递");else t.toast("请填写地址");else t.toast("商品信息不存在")}else t.toast("商品信息不存在")},t.refreshScore=function(){t.timer&&(i.cancel(t.timer),t.timer=null),t.timer=i(function(){var e=t.scoreInfo.score>t.maxUseScore?t.maxUseScore:t.scoreInfo.score;t.input.score>e&&(t.input.score=e),t.input.score<0&&(t.input.score=0),u.input.score=t.input.score,g(),t.timer=null},200)},t.refreshComment=function(){u.input.comment=t.input.comment},t.goods=u.goods,t.consignee=u.consignee,t.invoiceType=u.invoiceType,t.invoiceTitle=u.invoiceTitle,t.invoiceContent=u.invoiceContent,t.cashgift=u.cashgift,t.express=u.express,t.coupon=u.coupon,t.all_discount=0,t.input={score:0,comment:""},t.input.score=u.input.score,0==t.input.score&&(t.input.score=""),t.input.comment=u.input.comment,t.scoreInfo=null,t.priceInfo=null,t.canPurchase=!!(t.goods&&t.goods.length&&t.consignee&&t.express),t.maxUseScore=0,t.formatPromo=function(t){return"score"==t?"积分":"cashgift"==t?"红包":"preferential"==t?"优惠金额":"goods_reduction"==t?"商品减免":"order_reduction"==t?"订单减免":"coupon_reduction"==t?"优惠券减免":"其他优惠"},g(),f(),h()):i(function(){r.goHome()},1)}angular.module("app").controller("ConfirmCartController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","ConfirmCartService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function t(t,e){t.state("confirm-cart",{needAuth:!0,url:"/confirm-cart",templateUrl:"modules/confirm-cart/confirm-cart.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a={};return a.product=null,a.properties=null,a.amount=null,a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.shippingVendor=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.express=null,a.clear=function(){this.product=null,this.properties=null,this.amount=null,this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},a.input={score:0,comment:""},i.$on("consigneeChanged",function(t,e){a.consignee=e}),i.$on("expressChanged",function(t,e){a.express=e}),i.$on("invoiceChanged",function(t,e){a.invoiceTitle=e.title,a.invoiceType=e.type,a.invoiceContent=e.content}),i.$on("cashgiftChanged",function(t,e){a.cashgift=e}),a}angular.module("app").factory("ConfirmProductService",t),t.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){function u(){if(t.consignee){var e=[];for(var o in t.selectedGoods){var n=t.selectedGoods[o],i={goods_id:n.product.id,property:n.attrs,num:n.amount,total_amount:n.amount};e.push(i)}var a={};a.order_product=JSON.stringify(e),t.consignee&&(a.consignee=t.consignee.id),t.express&&(a.shipping=t.express.id),t.cashgift&&(a.cashgift=t.cashgift.id),t.coupon&&(a.coupon=t.coupon.id),t.input.score&&(a.score=t.input.score),r.order.price(a).then(function(e){if(e){t.priceInfo=e,t.all_discount=parseFloat(e.discount_price);for(var o=0;o<e.promos.length;++o){var n=e.promos[o];t.all_discount+=parseFloat(n.price)}}})}}if(t.touchAddress=function(){e.go("address-select",{address:t.consignee?t.consignee.id:null})},t.touchExpress=function(){if(t.consignee){var o=[],n=[],r=[];for(var i in t.selectedGoods){var s=t.selectedGoods[i];o.push(s.product.id),n.push(s.amount);var c=s.attrs[0],u=[];c?u.push(c.toString()):u.push(""),r.push(u)}a.clear(),a.expressId=t.express?t.express.id:null,a.goodsIds=o,a.goodsNumbers=n,a.region=t.consignee.id,a.propertys=r,e.go("express-select",{})}else t.toast("请选择地址")},t.touchInvoice=function(){s.clear(),s.type=t.invoiceType?t.invoiceType:null,s.title=t.invoiceTitle,s.content=t.invoiceContent?t.invoiceContent:null,e.go("invoice-select",{})},t.touchCashgift=function(){e.go("cashgift-select",{cashgift:t.cashgift?t.cashgift.id:null,total:t.priceInfo?t.priceInfo.product_price:0})},t.touchSubmit=function(){var o=t.consignee,n=t.express;if(o)if(n){var s={};for(var u in t.selectedGoods){var l=t.selectedGoods[u];s.product=l.product.id,s.property=JSON.stringify(l.attrs),s.amount=l.amount}t.consignee&&(s.consignee=t.consignee.id),t.express&&(s.shipping=t.express.id),t.cashgift&&(s.cashgift=t.cashgift.id),t.input.score&&(s.score=t.input.score),t.invoiceContent&&(s.invoice_content=t.invoiceContent.name),t.invoiceType&&(s.invoice_type=t.invoiceType.name),t.invoiceTitle&&(s.invoice_title=t.invoiceTitle),t.input.comment&&(s.comment=t.input.comment),r.product.purchase(s).then(function(t){t&&(i.clear(),a.clear(),c.clear(),c.order=t,e.go("payment",{order:t.id}))})}else t.toast("请选择快递");else t.toast("请填写地址")},t.refreshScore=function(){var e=t.scoreInfo.score>t.maxUseScore?t.maxUseScore:t.scoreInfo.score;t.input.score>e&&(t.input.score=e),t.input.score<0&&(t.input.score=0),i.input.score=t.input.score,u()},t.refreshComment=function(){i.input.comment=t.input.comment},t.consigneeList=[],t.consignee=i.consignee,t.invoiceType=i.invoiceType,t.invoiceTitle=i.invoiceTitle,t.invoiceContent=i.invoiceContent,t.cashgift=i.cashgift,t.express=i.express,t.coupon=i.coupon,t.all_discount=0,t.input={score:0,comment:""},t.input.score=i.input.score,t.input.comment=i.input.comment,0==t.input.score&&(t.input.score=""),t.rule="",t.scoreInfo=null,t.priceInfo={},t.canPurchase=function(){return!!(t.selectedGoods&&t.selectedGoods.length&&t.consignee&&t.express)},t.formatPromo=function(t){return"score"==t?"积分":"cashgift"==t?"红包":"preferential"==t?"优惠金额":"goods_reduction"==t?"商品减免":"order_reduction"==t?"订单减免":"coupon_reduction"==t?"优惠券减免":"其他优惠"},t.maxUseScore=0,t.selectedGoods=[],i.product){var l={};l.product=i.product;var d=i.attrs;l.property="",l.attrs=[];for(var p=parseFloat(l.product.current_price),h=d.length,f=0;f<h;f++)for(var g=l.product.properties.length,m=0;m<g;m++)for(var v=l.product.properties[m],y=v.attrs.length,$=0;$<y;$++){var A=v.attrs[$];parseInt(A.id)==d[f]&&(l.property.length>0?l.property+=","+A.attr_name:l.property=A.attr_name,l.attrs.push(A.id),p+=parseFloat(A.attr_price))}l.amount=i.amount,l.price=p,t.selectedGoods.push(l),function(){var e={};r.consignee.list(e).then(function(e){if(e&&(t.consigneeList=e,!t.consignee)){for(var n in t.consigneeList)t.consigneeList[n].is_default&&(t.consignee=t.consigneeList[n],o.$emit("consigneeChanged",t.consignee));u()}})}(),function(){t.maxUseScore=0;for(var e=0;e<t.selectedGoods.length;++e)t.maxUseScore+=t.selectedGoods[e].product.score*t.selectedGoods[e].amount;r.score.get({}).then(function(e){t.scoreInfo=e})}(),u()}}angular.module("app").controller("ConfirmController",t),t.$inject=["$scope","$state","$rootScope","$stateParams","API","ConfirmProductService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function t(t,e){t.state("confirm-product",{needAuth:!0,url:"/confirm-product",title:"确认订单",templateUrl:"modules/confirm-product/confirm-product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.isEmpty=!1,c.isLoaded=!1,c.isLoading=!1,c.types=null,c.order=null,c.reload=function(){if(i.getToken()){var t=this;return a.payment.typeList({}).then(function(e){return e&&(t.types=e,t.isEmpty=!t.groups||!t.groups.length,t.isLoaded=!0,t.isLoading=!1),!!e})}},c.clear=function(){this.order=null},c}angular.module("app").factory("PaymentModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){u.order?(t.selectedType=null,t.paymentModel=u,t.isSelected=function(e){return!!t.selectedType&&e.code==t.selectedType.code},t.touchSelect=function(e){t.selectedType=e},t.touchSubmit=function(){if(t.selectedType)switch(t.selectedType.code){case"alipay.app":case"alipay.wap":n.go("alipay-wap",{order:u.order.id});break;case"wxpay.app":case"wxpay.web":r.isWeixin()?n.go("wechat-pay",{order:u.order.id}):t.toast("暂不支持此方式");break;case"unionpay.app":t.toast("暂不支持此方式");break;case"teegon.wap":n.go("teegon",{order:u.order.id});break;default:t.toast("暂不支持此方式")}else t.toast("请选择支持方式")},t.touchDetail=function(){n.go("order-detail",{order:t.paymentModel.order.id})},t.paymentModel.reload().then(function(t){})):i(function(){r.goHome()},1)}angular.module("app").controller("PaymentController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel"]}(),function(){"use strict";function t(t,e){t.state("payment",{needAuth:!1,url:"/payment",title:"收银台",templateUrl:"modules/payment/payment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("payment-success",{needAuth:!0,url:"/payment-success?order",title:"付款成功",templateUrl:"modules/payment-success/payment-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.reason=r.reason,t.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentFailedController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("payment-failed",{needAuth:!0,url:"/payment-failed?order&reason",title:"支付失败",templateUrl:"modules/payment-failed/payment-failed.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a={};return a.title=null,a.type=null,a.content=null,a.clear=function(){this.title=null,this.type=null,this.content=null},a}angular.module("app").factory("InvoiceSelectService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){function c(){i.invoice.typeList({}).then(function(e){for(var o=new Array,n=0;n<e.length;n++){var r=e[n];r.name.length&&o.push(r)}t.types=o;var i=t.selectedType;if(i)for(n=0;n<e.length;++n)if(e[n].id==i.id){t.selectedType=e[n];break}t.noInvoice=l()})}function u(){i.invoice.contentList({}).then(function(e){t.contents=e;var o=t.selectedContent;if(o)for(var n=0;n<e.length;++n)if(e[n].id==o.id){t.selectedContents=e[n];break}t.noInvoice=l()})}function l(){return(!t.input.title||!t.input.title.length)&&(!t.selectedType&&!t.selectedContent)}t.input={title:s.title},t.selectedType=s.type,t.selectedContent=s.content,t.types=null,t.contents=null,t.touchType=function(e){t.selectedType=e,t.noInvoice=!1},t.touchContent=function(e){t.selectedContent=e,t.noInvoice=!1},t.touchConfirm=function(){if(t.noInvoice)o.$emit("invoiceChanged",{title:null,type:null,content:null}),t.goBack();else{if(!t.types)return void t.toast("请选择发票类型");if(!t.contents)return void t.toast("请选择发票明细");if(!t.input.title||!t.input.title.length)return void t.toast("请填写发票抬头");o.$emit("invoiceChanged",{title:t.input.title,type:t.selectedType,content:t.selectedContent}),t.goBack()}},t.touchToggle=function(){t.noInvoice=!t.noInvoice,t.noInvoice&&(t.input.title=null,t.selectedType=null,t.selectedContent=null)},t.noInvoice=l(),c(),u()}angular.module("app").controller("InvoiceSelectController",t),t.$inject=["$scope","$http","$rootScope","$stateParams","$state","API","ENUM","InvoiceSelectService"]}(),function(){"use strict";function t(t,e){t.state("invoice-select",{needAuth:!0,url:"/invoice-select",title:"发票信息",templateUrl:"modules/invoice-select/invoice-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a={};return a.expressId=null,a.goodsIds=null,a.goodsNumbers=null,a.region=null,a.clear=function(){this.expressId=null,this.goodsIds=null,this.goodsNumbers=null,this.region=null,this.propertys=null},a.propertys=null,a}angular.module("app").factory("ExpressSelectService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){t.selectedId=c.expressId||null,t.goodsIds=c.goodsIds||[],t.propertys=c.propertys||[],t.goodsNumbers=c.goodsNumbers||[],t.region=c.region||null,t.vendors=[],t.touchVendor=function(e){n.$emit("expressChanged",e),t.goBack()},function(){for(var e=t.goodsIds,o=t.goodsNumbers,n=t.propertys,r=[],i=0;i<e.length&&i<o.length;++i)r.push({goods_id:e[i],property:n[i],num:o[i]});var s=[];for(var c in t.selectedGoods){var u=t.selectedGoods[c],l={goods_id:u.product.id,num:u.amount};s.push(l)}a.shipping.vendorList({shop:1,products:JSON.stringify(r),address:t.region}).then(function(e){t.vendors=e})}()}angular.module("app").controller("ExpressSelectController",t),t.$inject=["$scope","$http","$window","$rootScope","$state","$stateParams","API","ENUM","ExpressSelectService"]}(),function(){"use strict";function t(t,e){t.state("express-select",{needAuth:!0,url:"/express-select",title:"配送方式",templateUrl:"modules/express-select/express-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.cashgifts=null,u.totalPrice=0,u.clear=function(){this.cashgifts=null,this.totalPrice=0},u.fetch=function(t,e){if(s.getToken()){this.isLoading=!0;var o=this;i.cashgift.available({total_price:this.totalPrice,page:t,per_page:e}).then(function(t){o.cashgifts=o.cashgifts?o.cashgifts.concat(t):t,o.isEmpty=!o.cashgifts||!o.cashgifts.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<e)&&!o.isEmpty})}},u.reload=function(){s.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.fetch(1,c)))},u.loadMore=function(){s.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("CashgiftSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.selectedId=i.cashgift||null,t.totalPrice=i.total||0,t.cashgiftSelectModel=u,t.cashgiftSelectModel.clear(),t.cashgiftSelectModel.totalPrice=t.totalPrice,t.touchClear=function(){t.selectedId=null},t.touchCashgift=function(e){t.selectedId=e.id},t.touchConfirm=function(){var e=null,o=t.cashgiftSelectModel.cashgifts;for(var n in o)if(o[n].id==t.selectedId){e=o[n];break}r.$emit("cashgiftChanged",e),t.goBack()},t.cashgiftSelectModel.reload()}angular.module("app").controller("CashgiftSelectController",t),t.$inject=["$scope","$http","$location","$timeout","$rootScope","$stateParams","$state","API","ENUM","CashgiftSelectModel"]}(),function(){"use strict";function t(t,e){t.state("cashgift-select",{needAuth:!0,url:"/cashgift-select?cashgift&total",title:"选择红包",templateUrl:"modules/cashgift-select/cashgift-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a){var s={};return s.isLoading=!1,s.isLoaded=!1,s.consignees=null,s.clear=function(){this.consignees=null},s.reload=function(){this.isLoading=!1,this.isLoaded=!1;var t=this;return i.consignee.list({}).then(function(e){t.consignees=e,t.isLoading=!1,t.isLoaded=!0})},s}angular.module("app").factory("AddressSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){t.selectedId=o.address,t.addressSelectModel=c,t.touchCreate=function(){t.addressEditModel.clear(),t.addressEditModel.consignee=null,r.go("address-edit",{})},t.touchModify=function(e){t.addressEditModel.clear(),t.addressEditModel.consignee=e,r.go("address-edit",{})},t.touchConsignee=function(e){n.$emit("consigneeChanged",e),t.goBack()},t.touchDefaultAddress=function(e){i.consignee.setDefault({consignee:e.id}).then(function(o){if(o)for(var n=0;n<t.myAddressModel.consignees.length;n++){var r=t.myAddressModel.consignees[n];r.id==e.id?r.is_default=!0:r.is_default=!1}else t.toast("设置失败")})},t.isDefaultAddress=function(t){return!!t.is_default},t.addressEditModel=s,t.goMyAddress=function(){r.go("my-address",{})},t.addressSelectModel.clear(),t.addressSelectModel.reload()}angular.module("app").controller("AddressSelectController",t),t.$inject=["$scope","$http","$stateParams","$rootScope","$state","API","ENUM","AddressEditModel","AddressSelectModel"]}(),function(){"use strict";function t(t,e){t.state("address-select",{needAuth:!0,url:"/address-select?address",title:"选择地址",templateUrl:"modules/address-select/address-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){function c(){if(s.getToken()&&!this.isLoading){this.isLoading=!0;var t=this;return i.region.list({}).then(function(e){return e&&e.length?(t.isLoading=!1,t.isLoaded=!0,t.regions=e):$scope.toast("没有可选地址"),!!e})}}var u={};return u.isLoaded=!1,u.isLoading=!1,u.consignee=null,u.regions=null,u.save=function(t,e,o,n){if(s.getToken()){if(this.consignee&&this.consignee.id)return r=this,i.consignee.update({consignee:this.consignee.id,name:t,mobile:e,tel:e,zip_code:"",region:o,address:n}).then(function(t){return r.consignee=t,!!t});var r=this;return i.consignee.add({name:t,mobile:e,tel:e,zip_code:"",region:o,address:n}).then(function(t){return r.consignee=t,!!t})}},u.clear=function(){this.consignee=null},u.reload=c,u.reload=c,u.reloadIfNeeded=function(){if(s.getToken()){if(this.isLoaded){var t=e.defer();return o(function(){t.resolve(!0)},1),t.promise}return this.reload()}},u}angular.module("app").factory("AddressEditModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){function u(t){for(var e="",o=0;o<t.length;++o)e+=t[o].name,e+=" ";return e}t.touchSave=function(){var e=t.name,o=t.mobile,n=t.address,r=t.regions;if(!e||e.length<2)t.toast("请输入姓名");else if(!o||o.length<5)t.toast("请输入电话");else if(r&&r.length){var i=r[r.length-1];i?!n||n.length<1?t.toast("请输入地址"):t.allowSave&&(t.allowSave=!1,t.addressEditModel.save(e,o,i.id,n).then(function(e){t.allowSave=!0,e?(t.toast("保存成功"),t.goBack()):t.toast("请稍后再试")})):t.toast("请选择地区")}else t.toast("请选择地区")},t.touchSetDefault=function(){t.isDefault=!t.isDefault},t.touchPickerShow=function(){t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null,t.showPicker=!0,t.addressEditModel.reloadIfNeeded().then(function(e){e?t.pickerData=t.addressEditModel.regions:(t.toast("请稍后再试"),t.touchPickerCancel())})},t.touchPickerRegion=function(e){t.pickerRegions.push(e),t.pickerRegionName=u(t.pickerRegions),e.regions&&e.regions.length?t.pickerData=e.regions:(t.regions=t.pickerRegions,t.showPicker=!1)},t.touchPickerCancel=function(){t.showPicker=!1,t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null},t.formatRegions=u,t.touchDelete=function(){var e={};e.consignee=t.addressEditModel.consignee.id,o.consignee.delete(e).then(function(e){e?(t.toast("删除成功"),t.goBack()):t.toast("删除失败")})},t.touchCancel=function(){t.goBack()},t.showPicker=!1,t.allowSave=!0,t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null,t.addressEditModel=c;var l=t.addressEditModel.consignee;l&&l.id&&(t.name=l.name,t.mobile=l.mobile,t.regions=l.regions,t.address=l.address,t.isDefault=l.is_default)}angular.module("app").controller("AddressEditController",t),t.$inject=["$scope","$http","API","$location","$q","$window","$state","$stateParams","AddressEditModel"]}(),function(){"use strict";function t(t,e){t.state("address-edit",{needAuth:!0,url:"/address-edit",title:"收货地址",templateUrl:"modules/address-edit/address-edit.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.orders=null,u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;a.order.list(o).then(function(t){n.orders=n.orders?n.orders.concat(t):t,n.isEmpty=!n.orders||!n.orders.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.orders=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.orders&&this.orders.length?this.fetch(this.orders.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("MyOrderModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l,d){t.TAB_ALL=0,t.TAB_CREATED=1,t.TAB_PAID=2,t.TAB_DELIVERING=3,t.TAB_DELIVERIED=4,t.currentTab=t.TAB_ALL,t.cancellingOrder=null,t.showDialog=!1,t.myOrderModel=l,t.paymentModel=u,t.orderExpressModel=d,"all"==a.tab?(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null):"created"==a.tab?(t.currentTab=t.TAB_CREATED,t.myOrderModel.status=c.ORDER_STATUS.CREATED):"paid"==a.tab?(t.currentTab=t.TAB_PAID,t.myOrderModel.status=c.ORDER_STATUS.PAID):"delivering"==a.tab?(t.currentTab=t.TAB_DELIVERING,t.myOrderModel.status=c.ORDER_STATUS.DELIVERING):"delivered"==a.tab?(t.currentTab=t.TAB_DELIVERIED,t.myOrderModel.status=c.ORDER_STATUS.DELIVERIED):(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null),t.touchTabAll=function(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null,t.myOrderModel.reload())},t.touchTabCreated=function(){t.currentTab!=t.TAB_CREATED&&(t.currentTab=t.TAB_CREATED,t.myOrderModel.status=c.ORDER_STATUS.CREATED,t.myOrderModel.reload())},t.touchTabPaid=function(){t.currentTab!=t.TAB_PAID&&(t.currentTab=t.TAB_PAID,t.myOrderModel.status=c.ORDER_STATUS.PAID,t.myOrderModel.reload())},t.touchTabDelivering=function(){t.currentTab!=t.TAB_DELIVERING&&(t.currentTab=t.TAB_DELIVERING,t.myOrderModel.status=c.ORDER_STATUS.DELIVERING,t.myOrderModel.reload())},t.touchTabDeliveried=function(){t.currentTab!=t.TAB_DELIVERIED&&(t.currentTab=t.TAB_DELIVERIED,t.myOrderModel.status=c.ORDER_STATUS.DELIVERIED,t.myOrderModel.reload())},t.touchDialogCancel=function(){t.cancellingOrder=null,t.showDialog=!1},t.touchDialogConfirm=function(){s.order.cancel({order:t.cancellingOrder.id,reason:1}).then(function(e){t.myOrderModel.reload(),t.cancellingOrder=null,t.showDialog=!1})},t.touchOrder=function(t){i.go("order-detail",{order:t.id})},t.touchPay=function(e){e&&(t.paymentModel.clear(),t.paymentModel.order=e,i.go("payment",{}))},t.touchCancel=function(e){t.cancellingOrder=e,t.showDialog=!0},t.touchConfirm=function(t){s.order.confirm({order:t.id}).then(function(t){i.go("confirm-delivery",{order:t.id})})},t.touchExpress=function(e){t.orderExpressModel.clear(),t.orderExpressModel.order=e,i.go("order-express",{order:e.id})},t.touchComment=function(t){i.go("order-review",{order:t.id})},t.myOrderModel.reload()}angular.module("app").controller("MyOrderController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyOrderModel","OrderExpressModel"]}(),function(){"use strict";function t(t,e){t.state("my-order",{needAuth:!0,url:"/my-order?tab",title:"我的订单",templateUrl:"modules/my-order/my-order.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){function d(){t.isLoading=!0,t.isLoaded=!1,s.order.get({order:p}).then(function(e){t.order=e;var o=e.promos;t.promos=[];for(var n in o)"score"==o[n].promo?o[n].name="积分":"cashgift"==o[n].promo?o[n].name="红包":"preferential"==o[n].promo?o[n].name="优惠金额":"goods_reduction"==o[n].promo?o[n].name="商品减免":"order_reduction"==o[n].promo?o[n].name="订单减免":"coupon_reduction"==o[n].promo&&(o[n].name="优惠券减免");t.promos=o,t.isLoading=!1,t.isLoaded=!0})}var p=a.order;t.order={id:p},t.isLoading=!1,t.isLoaded=!1,t.touchPay=function(){t.order&&(t.paymentModel.clear(),t.paymentModel.order=t.order,i.go("payment",{}))},t.touchCancel=function(){t.order&&(t.showDialog=!0)},t.touchConfirm=function(){s.order.confirm({order:p}).then(function(e){t.toast("确认成功"),d()})},t.touchExpress=function(){t.orderExpressModel.clear(),t.orderExpressModel.order=t.order,i.go("order-express",{order:t.order.id})},t.touchComment=function(){i.go("order-review",{order:t.order.id})},t.touchProduct=function(t){i.go("product",{product:t.id})},t.showDialog=!1,t.touchDialogCancel=function(){t.showDialog=!1},t.touchDialogConfirm=function(){s.order.cancel({order:p,reason:1}).then(function(e){t.toast("取消成功"),t.showDialog=!1,d()})},t.paymentModel=u,t.orderExpressModel=l,d()}angular.module("app").controller("OrderDetailController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","OrderExpressModel"]}(),function(){"use strict";function t(t,e){t.state("order-detail",{needAuth:!0,url:"/order-detail/?order",title:"订单详情",templateUrl:"modules/order-detail/order-detail.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c){var u=a.order;t.order={id:u},t.isLoading=!1,t.isLoaded=!1,t.isAnonymous=0,t.touchGood=function(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.GOOD,t.review.content||(t.review.content="")},t.touchMedium=function(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.MEDIUM,t.review.content||(t.review.content="")},t.touchBad=function(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.BAD,t.review.content||(t.review.content="")},t.touchSetAnonymous=function(){t.isAnonymous=!t.isAnonymous},t.touchSubmit=function(){for(var e=[],o=0;o<t.order.goods.length;o++){var n=t.order.goods[o];if(n.review){if(!n.review.grade)return void t.toast("请选择评价");e.push(n.review)}}if(e.length<t.order.goods.length)t.toast("请评价全部商品");else{var r={};r.order=u,r.review=JSON.stringify(e),t.isAnonymous?r.is_anonymous=1:r.is_anonymous=0,s.order.review(r).then(function(e){e&&i.go("review-success",{order:t.order.id})})}},t.isLoading=!0,t.isLoaded=!1,s.order.get({order:u}).then(function(e){t.order=e,t.isLoading=!1,t.isLoaded=!0})}angular.module("app").controller("OrderReviewController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("order-review",{needAuth:!0,url:"/order-review?order",title:"订单评价",templateUrl:"modules/order-review/order-review.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.order=null,c.info=null,c.clear=function(){this.order=null,this.info=null},c.reload=function(){var t=this;return a.shipping.statusGet({order_id:this.order.id,tracking_no:null}).then(function(e){return t.info=e,!!e})},c}angular.module("app").factory("OrderExpressModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.orderExpressModel=u,t.orderExpressModel.reload()}angular.module("app").controller("OrderExpressController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","OrderExpressModel"]}(),function(){"use strict";function t(t,e){t.state("order-express",{needAuth:!0,url:"/order-express/?order",title:"物流信息",templateUrl:"modules/order-express/order-express.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){var a=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname);if(i.getReferences())var s=parseInt(i.getReferences()),c=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_userinfo&invite_code="+s+"&referer="+a;else c=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_userinfo&referer="+a;o.location.href=c}angular.module("app").controller("WeChatAuthController",t),t.$inject=["$scope","$http","$window","$location","$timeout","AppAuthenticationService"]}(),function(){"use strict";function t(t,e){t.state("wechat-auth",{needAuth:!1,url:"/wechat-auth",title:"微信登录",controller:"WeChatAuthController",templateUrl:"modules/wechat-auth/wechat-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){var d=a.order;if(d){o.$on("onPaySuccess",function(t,e){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(t,e){r.go("payment-failed",{order:d,reason:"微信支付失败"})});var p=l.getConfig()["wxpay.web"];p?(wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:p.app_id,timestamp:p.timestamp,nonceStr:p.nonceStr,signature:p.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){s.pay(d).then(function(t){})}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(t))})):r.go("payment-failed",{order:d,reason:"配置错误"})}else r.go("payment-failed",{order:d,reason:"参数错误"})}angular.module("app").controller("WeChatPayController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","WeixinService","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("wechat-pay",{needAuth:!0,url:"/wechat-pay?order",title:"微信支付",controller:"WeChatPayController",templateUrl:"modules/wechat-pay/wechat-pay.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_base&referer="+i;o.location.href=a}angular.module("app").controller("WeChatAuthBaseController",t),t.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function t(t,e){t.state("wechat-authbase",{needAuth:!1,url:"/wechat-authbase",title:"微信登录",controller:"WeChatAuthBaseController",templateUrl:"modules/wechat-authbase/wechat-authbase.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){t.paymentModel=s;var d=a.order;if(d){o.$on("onPaySuccess",function(t,e){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(t,e){r.go("payment-failed",{order:d,reason:"支付宝支付失败"})});var p=encodeURIComponent(n.location.protocol+"//"+n.location.host+n.location.pathname),h={order:d,code:"alipay.wap",referer:p};c.payment.pay(h).then(function(e){return e.data.alipay&&e.data.alipay.html&&(t.alipay_html=u.trustAsHtml(e.data.alipay.html)),!0})}else r.go("payment-failed",{order:d,reason:"参数错误"})}angular.module("app").controller("AliPayWapController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","PaymentModel","API","$sce","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("alipay-wap",{needAuth:!0,url:"/alipay-wap?order",title:"微信支付",controller:"AliPayWapController",templateUrl:"modules/alipay-wap/alipay-wap.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.isEmpty=!1,c.isLoaded=!1,c.isLoading=!1,c.isLastPage=!1,c.consignees=null,c.reload=function(){if(i.getToken()&&!this.isLoading){this.consignees=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1;var t=this;a.consignee.list({}).then(function(e){t.consignees=e,t.isEmpty=!t.consignees||!t.consignees.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=!0})}},c}angular.module("app").factory("MyAddressModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.touchCreate=function(){t.addressEditModel.clear(),t.addressEditModel.consignee=null,i.go("address-edit",{})},t.touchModify=function(e){t.addressEditModel.clear(),t.addressEditModel.consignee=e,i.go("address-edit",{})},t.myAddressModel=u,t.addressEditModel=c,t.touchDefaultAddress=function(e){a.consignee.setDefault({consignee:e.id}).then(function(o){if(o)for(var n=0;n<t.myAddressModel.consignees.length;n++){var r=t.myAddressModel.consignees[n];r.id==e.id?r.is_default=!0:r.is_default=!1}else t.toast("设置失败")})},t.isDefaultAddress=function(t){return!!t.is_default},t.myAddressModel.reload()}angular.module("app").controller("MyAddressController",t),t.$inject=["$scope","$http","$rootScope","$stateParams","$location","$state","API","ENUM","AddressEditModel","MyAddressModel"]}(),function(){"use strict";function t(t,e){t.state("my-address",{needAuth:!0,url:"/my-address",title:"地址管理",templateUrl:"modules/my-address/my-address.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.products=null,u.fetch=function(t,e){this.isLoading=!0;var o=this;a.product.likedList({page:t,per_page:e}).then(function(t){o.products=o.products?o.products.concat(t):t,o.isEmpty=!o.products||!o.products.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<e)&&!o.isEmpty})},u.reload=function(){i.getToken()&&(this.isLoading||(this.products=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){this.isLoading||this.isLastPage||(this.products&&this.products.length?this.fetch(this.products.length/c+1,c):this.fetch(1,c))},u.delete=function(t){if(i.getToken()){var e=this;a.product.unlike({product:t}).then(function(t){e.reload()})}},u}angular.module("app").factory("MyFavoriteModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r){t.myFavoriteModel=r,t.touchProduct=function(t){e.go("product",{product:t.id})},t.touchDelete=function(e){t.myFavoriteModel.delete(e.id)},t.myFavoriteModel.reload()}angular.module("app").controller("MyFavoriteController",t),t.$inject=["$scope","$state","API","ENUM","MyFavoriteModel"]}(),function(){"use strict";function t(t,e){t.state("my-favorite",{needAuth:!0,url:"/my-favorite",title:"我的收藏",templateUrl:"modules/my-favorite/my-favorite.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.cashgifts=null,u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};o.status=this.status;var n=this;a.cashgift.list(o).then(function(t){n.cashgifts=n.cashgifts?n.cashgifts.concat(t):t,n.isEmpty=!n.cashgifts||!n.cashgifts.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("MyCashgiftModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a){t.TAB_AVAILABLE=0,t.TAB_EXPIRED=1,t.TAB_USED=2,t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel=i,"available"==n.tab?(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE):"expired"==n.tab?(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED):"used"==n.tab?(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=a.CASHGIFT_STATUS.USED):(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE),t.touchTabAvailable=function(){t.currentTab!=t.TAB_AVAILABLE&&(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE,t.myCashgiftModel.reload())},t.touchTabExpired=function(){t.currentTab!=t.TAB_EXPIRED&&(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED,t.myCashgiftModel.reload())},t.touchTabUsed=function(){t.currentTab!=t.TAB_USED&&(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=a.CASHGIFT_STATUS.USED,t.myCashgiftModel.reload())},t.myCashgiftModel.reload()}angular.module("app").controller("MyCashgiftController",t),t.$inject=["$scope","$http","$location","$stateParams","$state","MyCashgiftModel","ENUM"]}(),function(){"use strict";function t(t,e){t.state("my-cashgift",{needAuth:!0,url:"/my-cashgift",title:"我的红包",templateUrl:"modules/my-cashgift/my-cashgift.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.score=null,u.rule=null,u.history=null,u.count=function(){if(i.getToken()){var t=this;a.score.get({}).then(function(e){t.score=e.score,t.rule=e.rule})}},u.fetch=function(t,e){this.isLoading=!0;var o=this,n={page:t,per_page:e};this.status&&(n.status=this.status),a.score.historyList(n).then(function(t){o.history=o.history?o.history.concat(t):t,o.isEmpty=!o.history||!o.history.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<e)&&!o.isEmpty})},u.reload=function(){i.getToken()&&(this.isLoading||(this.history=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.history&&this.history.length?this.fetch(this.history.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("MyScoreModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){t.TAB_ALL=0,t.TAB_INCOME=1,t.TAB_EXPENDITURE=2,t.currentTab=t.TAB_ALL,t.myScoreModel=l,t.paymentModel=u,"all"==a.tab?(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null):"income"==a.tab?(t.currentTab=t.TAB_INCOME,t.myScoreModel.status=c.SCORE_STATUS.INCOME):"expenditure"==a.tab?(t.currentTab=t.TAB_EXPENDITURE,t.myScoreModel.status=c.SCORE_STATUS.EXPENDITURE):(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null),t.touchTabAll=function(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null,t.myScoreModel.reload())},t.touchTabIncome=function(){t.currentTab!=t.TAB_INCOME&&(t.currentTab=t.TAB_INCOME,t.myScoreModel.status=c.SCORE_STATUS.INCOME,t.myScoreModel.reload())},t.touchTabExpenditure=function(){t.currentTab!=t.TAB_EXPENDITURE&&(t.currentTab=t.TAB_EXPENDITURE,t.myScoreModel.status=c.SCORE_STATUS.EXPENDITURE,t.myScoreModel.reload())},t.myScoreModel.count(),t.myScoreModel.reload()}angular.module("app").controller("MyScoreController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyScoreModel"]}(),function(){"use strict";function t(t,e){t.state("my-score",{needAuth:!0,url:"/my-score?tab",title:"我的积分",templateUrl:"modules/my-score/my-score.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){function i(){if(!t.loading){var e={};c=1,e=a?{page:c,per_page:s,id:a}:{page:c,per_page:s,id:0},n.article.list(e).then(function(e){e&&(t.articles=e.articles,t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})}}t.touchArticle=function(t){t.url?r.location.href=t.url:e.go("article",{id:t.id,title:t.title})},t.articles=[];var a=o.id;o.title?t.title=o.title:t.title="使用帮助",t.loading=!1,t.loaded=!1,t.more=!0;var s=10,c=1;t.reload=i,t.loadMore=function(){if(!t.loading){var e={};e=a?{page:c,per_page:s,id:a}:{page:c,per_page:s,id:0},n.article.list(e).then(function(e){e&&(t.articles=t.articles.concat(e.articles),t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})}},i()}angular.module("app").controller("ArticleController",t),t.$inject=["$scope","$state","$stateParams","API","$window"]}(),function(){"use strict";function t(t,e){t.state("article",{needAuth:!1,url:"/article?id&title",title:"使用帮助",templateUrl:"modules/article/article.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){r.order;t.reason=r.reason,t.touchToHome=function(){n.go("home",{})}}angular.module("app").controller("ReviewSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("review-success",{needAuth:!0,url:"/review-success?order",title:"评价成功",templateUrl:"modules/review-success/review-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.isDelivery=!0,t.reason=r.reason,t.touchDetail=function(){n.go("order-detail",{order:i})},t.touchComment=function(){n.go("order-review",{order:i})}}angular.module("app").controller("ConfirmDeliveryController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("confirm-delivery",{needAuth:!0,url:"/confirm-delivery?order",title:"交易成功",templateUrl:"modules/confirm-delivery/confirm-delivery.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a){t.oldPassword="",t.newPassword="",t.touchChangePassword=function(){var e=t.oldPassword,o=t.newPassword;o==t.newPassword2?i.user.passwordUpdate({old_password:e,password:o}).then(function(e){0==e.data.error_code?(t.toast("密码修改成功"),t.goBack()):t.toast(e.data.error_desc)}):t.toast("两次密码输入不一致")}}angular.module("app").controller("ChangePasswordController",t),t.$inject=["$scope","$http","$window","$location","$state","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("change-password",{needAuth:!0,url:"/change-password",title:"修改密码",templateUrl:"modules/change-password/change-password.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){u.order?(t.selectedType=null,t.paymentModel=u,t.isSelected=function(e){return!!t.selectedType&&e.channel==t.selectedType.channel},t.touchSelect=function(e){t.selectedType=e},t.touchSubmit=function(){if(t.selectedType)switch(t.selectedType.channel){case"chinapay":var e=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:t.paymentModel.order.id,code:"teegon.wap",channel:"chinapay",referer:e};s.payment.pay(o).then(function(t){return t.data.teegon&&t.data.teegon.url&&(l.location.href=t.data.teegon.url),!0});break;case"wxpay":var e=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:t.paymentModel.order.id,code:"teegon.wap",channel:"wxpay_jsapi",referer:e};s.payment.pay(o).then(function(t){return t.data.teegon&&t.data.teegon.url&&(l.location.href=t.data.teegon.url),!0})}else t.toast("请选择支持方式")},t.teegonTypes=[],function(){var e={name:"微信支付",desc:"天工收银微信支付",channel:"wxpay"},o={name:"天工收银银联支付",desc:"天工收银银联支付",channel:"chinapay"};t.teegonTypes.push(o),t.teegonTypes.push(e),t.paymentModel.reload().then(function(t){})}()):i(function(){r.goHome()},1)}angular.module("app").controller("TeegonController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","$window"]}(),function(){"use strict";function t(t,e){t.state("teegon",{needAuth:!1,url:"/teegon",title:"收银台",templateUrl:"modules/teegon/teegon.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=3&referer="+i;o.location.href=a}angular.module("app").controller("QQAuthController",t),t.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function t(t,e){t.state("qq-auth",{needAuth:!1,url:"/qq-auth",title:"QQ登录",controller:"QQAuthController",templateUrl:"modules/qq-auth/qq-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l){t.cancellingOrder=null,t.showDialog=!1,t.bonus_amount=0,t.total_bonus=0,t.myBonusModel=u,t.touchDialogCancel=function(){t.cancellingOrder=null,t.showDialog=!1},t.touchDialogConfirm=function(){s.order.cancel({order:t.cancellingOrder.id,reason:1}).then(function(e){t.myOrderModel.reload(),t.cancellingOrder=null,t.showDialog=!1})},t.touchRecommend=function(){i.go("my-recommend",{})},t.touchMyBalance=function(){i.go("my-balance",{})},t.touchRules=function(){i.go("bonus-rule",{})},t.touchCancel=function(e){t.cancellingOrder=e,t.showDialog=!0},t.getBonusStatus=function(t){return t==c.BONUS_STATUS.WAIT?"审核中":t==c.BONUS_STATUS.FINISH?"已分成":t==c.BONUS_STATUS.CANCEL?"已取消":t==c.BONUS_STATUS.REVOKE?"已撤销":""},t.getBonusType=function(t){return t==c.BONUS_TYPE.SIGNUP?"注册分成":"订单分成"},t.myBonusModel.reload()}angular.module("app").controller("BonusController",t),t.$inject=["$scope","$rootScope","$window","$timeout","$location","$state","$stateParams","API","ENUM","BonusModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("bonus",{needAuth:!0,url:"/bonus",title:"我的订单",templateUrl:"modules/bonus/bonus.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;a.bonus.list(o).then(function(t){return n.bonuses=n.bonuses?n.bonuses.concat(t):t,n.isEmpty=!n.bonuses||!n.bonuses.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty,!0})}},u.getInfo=function(){if(i.getToken()){var t={},e=this;a.bonus.get(t).then(function(t){return e.bonus_info=t,!0})}},u.reload=function(){if(i.getToken()&&!this.isLoading)return this.bonuses=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c),this.getInfo()},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.bonuses&&this.bonuses.length?this.fetch(this.bonuses.length/c+1,c):this.fetch(1,c)))},u.bonuses=[],u}angular.module("app").factory("BonusModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){t.touchBalanceDetail=function(){r.go("balance-history",{})},t.touchWithDrawHistory=function(){r.go("withdraw-history",{})},t.touchWithDraw=function(){t.showDialog=!0},t.touchDialogCancel=function(){t.showDialog=!1,t.input.memo="",t.input.withdraw=""},t.touchDialogConfirm=function(){var e=parseFloat(t.input.withdraw);if(isNaN(e))t.toast("请输入数字");else if(e<=0)t.toast("金额不能小于零");else if(e>parseFloat(t.balanceModel.balanceAmount))t.toast("金额超出提现范围");else if(0!=t.input.memo.length){var o={};o.cash=e,o.memo=t.input.memo,a.withdraw.submit(o).then(function(e){t.balanceModel.reload(),t.cancellingOrder=null,t.showDialog=!1,r.go("withdraw-success",{withdraw:e.cash,member_memo:e.member_memo})})}else t.toast("Memo不能为空")},t.touchWithDrawAll=function(){t.input.withdraw=parseFloat(t.balanceModel.balanceAmount)},t.balanceModel=s,t.input={withdraw:"",memo:""},t.balanceModel.reload()}angular.module("app").controller("MyBalanceController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","BalanceModel"]}(),function(){"use strict";function t(t,e){t.state("my-balance",{needAuth:!0,url:"/my-balance",title:"可用资金",templateUrl:"modules/my-balance/my-balance.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;a.balance.list(o).then(function(t){n.balances=n.balances?n.balances.concat(t):t,n.isEmpty=!n.balances||!n.balances.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.balances=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c),this.get()))},u.get=function(){if(i.getToken()){var t={},e=this;a.balance.get(t).then(function(t){e.balanceAmount=t})}},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.balances&&this.balances.length?this.fetch(this.balances.length/c+1,c):this.fetch(1,c)))},u.balances=[],u.balanceAmount=0,u}angular.module("app").factory("BalanceModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.TAB_ALL=0,t.TAB_INCOME=1,t.TAB_EXPENDITURE=2,t.currentTab=t.TAB_ALL,t.myBalanceModel=u,"all"==a.tab?(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null):"income"==a.tab?(t.currentTab=t.TAB_INCOME,t.myBalanceModel.status=c.BALANCE_STATUS.IN):"expenditure"==a.tab?(t.currentTab=t.TAB_EXPENDITURE,t.myBalanceModel.status=c.BALANCE_STATUS.OUT):(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null),t.touchTabAll=function(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null,t.myBalanceModel.reload())},t.touchTabIncome=function(){t.currentTab!=t.TAB_INCOME&&(t.currentTab=t.TAB_INCOME,t.myBalanceModel.status=c.BALANCE_STATUS.IN,t.myBalanceModel.reload())},t.touchTabExpenditure=function(){t.currentTab!=t.TAB_EXPENDITURE&&(t.currentTab=t.TAB_EXPENDITURE,t.myBalanceModel.status=c.BALANCE_STATUS.OUT,t.myBalanceModel.reload())},t.myBalanceModel.reload()}angular.module("app").controller("BalanceHistoryController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","BalanceModel"]}(),function(){"use strict";function t(t,e){t.state("balance-history",{needAuth:!0,url:"/balance-history",title:"资金明细",templateUrl:"modules/balance-history/balance-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.cancellingWithDraw=null,t.showDialog=!1,t.withDrawHistoryModel=u,t.touchDialogCancel=function(){t.cancellingWithDraw=null,t.showDialog=!1},t.touchDialogConfirm=function(){s.withdraw.cancel({id:t.cancellingWithDraw.id}).then(function(e){t.withDrawHistoryModel.reload(),t.cancellingWithDraw=null,t.showDialog=!1})},t.touchCancel=function(e){t.cancellingWithDraw=e,t.showDialog=!0},t.withDrawHistoryModel.reload()}angular.module("app").controller("WithDrawHistoryController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","WithDrawHistoryModel"]}(),function(){"use strict";function t(t,e){t.state("withdraw-history",{needAuth:!0,url:"/withdraw-history",title:"提现记录",templateUrl:"modules/withdraw-history/withdraw-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.withdraws=[],u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;a.withdraw.list(o).then(function(t){n.withdraws=n.withdraws?n.withdraws.concat(t):t,n.isEmpty=!n.withdraws||!n.withdraws.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.withdraws=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.withdraws&&this.withdraws.length?this.fetch(this.withdraws.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("WithDrawHistoryModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){t.myRecommendModel=s,t.myRecommendModel.reload()}angular.module("app").controller("MyRecommendController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","MyRecommendModel"]}(),function(){"use strict";function t(t,e){t.state("my-recommend",{needAuth:!0,url:"/my-recommend",title:"可用资金",templateUrl:"modules/my-recommend/my-recommend.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c={};return c.reload=function(){i.getToken()&&this.fetch()},c.fetch=function(){if(i.getToken()){var t=this,e={};a.recommend.bonusInfo(e).then(function(e){t.bonus_info=e})}},c}angular.module("app").factory("MyRecommendModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r){t.withdraw=r.withdraw,t.member_memo=r.member_memo}angular.module("app").controller("WithDrawSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("withdraw-success",{needAuth:!0,url:"/withdraw-success?withdraw&member_memo",title:"提现成功",templateUrl:"modules/withdraw-success/withdraw-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u){t.bonusModel=s,t.bonusModel.bonus_info&&(t.rule_desc=u.trustAsHtml(t.bonusModel.bonus_info.rule_desc)),c.bonus.get().then(function(e){t.rule_desc=u.trustAsHtml(e.rule_desc)})}angular.module("app").controller("BonusRuleController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","BonusModel","API","$sce"]}(),function(){"use strict";function t(t,e){t.state("bonus-rule",{needAuth:!1,url:"/bonus-rule",title:"分成规则",controller:"BonusRuleController",templateUrl:"modules/bonus-rule/bonus-rule.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s,c,u,l,d,p){function h(){var e={activity:t.activityId};p.activity.get(e).then(function(e){if(e){t.activityInfo=e,t.systemTimestamp=Date.parse(new Date)/1e3,t.systemTimestamp>t.activityInfo.start_at&&t.systemTimestamp<t.activityInfo.end_at?g():t.systemTimestamp<t.activityInfo.start_at&&(t.countdownBegin=!0),t.activityInfo.range==l.ACTIVITY_FAR.FAR_ALL?t.userScope="全部商品可用":t.activityInfo.range==l.ACTIVITY_FAR.FAR_CATEGORY?t.userScope="部分分类可用":t.activityInfo.range==l.ACTIVITY_FAR.FAR_BRAND?t.userScope="部分品牌可用":t.activityInfo.range==l.ACTIVITY_FAR.FAR_GOODS&&(t.userScope="部分商品可用"),t.userScope+="/";for(var o=0;o<t.activityInfo.user_rank.length;++o){var n=t.activityInfo.user_rank[o];t.userScope+=n.name,o!=t.activityInfo.user_rank.length-1&&(t.userScope+="、")}t.userScope+="可用",d.cancel(t.timer),t.timer=d(function(){f()},1e3,-1)}})}function f(){t.systemTimestamp=Date.parse(new Date)/1e3;e=t.activityInfo.end_at;if(t.systemTimestamp<t.activityInfo.start_at)var e=t.activityInfo.start_at;else t.countdownBegin&&(t.countdownBegin=!1,g());if(e>=t.systemTimestamp){var o=e-t.systemTimestamp,n=Math.floor(o/86400),r=Math.floor(o%86400/3600),i=Math.floor(o%86400%3600/60),a=Math.floor(o%86400%3600%60);n<10?(t.day_front="0",t.day_last=n):n>99?(t.day_front="9",t.day_last="9"):(t.day_last=n-10*Math.floor(n/10),t.day_front=(n-100*Math.floor(n/100)-t.day_last)/10),r<10?(t.hour_front="0",t.hour_last=r):(t.hour_last=r-10*Math.floor(r/10),t.hour_front=(r-100*Math.floor(r/100)-t.hour_last)/10),i<10?(t.minute_front="0",t.minute_last=i):(t.minute_last=i-10*Math.floor(i/10),t.minute_front=(i-100*Math.floor(i/100)-t.minute_last)/10),a<10?(t.second_front="0",t.second_last=a):(t.second_last=a-10*Math.floor(a/10),t.second_front=(a-100*Math.floor(a/100)-t.second_last)/10)}}function g(){t.products=null,t.isEmpty=!1,t.isLoaded=!1,m(1,y)}function m(e,o){t.isLoading=!0,p.product.list({activity:t.activityId,page:e,per_page:y}).then(function(e){t.products=t.products?t.products.concat(e):e,t.isEmpty=!t.products||!t.products.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=!!(e&&e.length<o)&&!t.isEmpty})}function v(){h()}var y=10;t.reload=v,t.activityInfo=null,t.activityId=a.activity,t.formatUrl=function(t){var e=Math.round((new Date).getTime()/1e3);return-1==t.indexOf("?")?t+"?v="+e:t+"&v="+e},t.day_front="0",t.hour_front="0",t.minute_front="0",t.second_front="0",t.day_last="0",t.hour_last="0",t.minute_last="0",t.second_last="0",t.isLoading=!1,t.isactive=!1,t.isEmpty=!1,t.isLoaded=!1,t.isLastPage=!1,t.timer=null,t.loadMore=function(){if(!t.isLoading&&!t.isLastPage&&t.products&&t.products.length){if(t.products.length%10)return;m(t.products.length/y+1,y)}},t.countdownBegin=!1,t.touchProduct=function(t){i.go("product",{product:t.id})},t.touchGoHome=function(){e.goHome()},t.systemTimestamp=Date.parse(new Date)/1e3,t.userScope="全部商品可用",v()}angular.module("app").controller("ActivityDetailController",t),t.$inject=["$scope","$rootScope","$http","$timeout","$location","$state","$stateParams","$window","AppAuthenticationService","MyOrderModel","ENUM","$interval","API"]}(),function(){"use strict";function t(t,e){t.state("activity-detail",{needAuth:!1,url:"/activity-detail?activity",templateUrl:"modules/activity-detail/activity-detail.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.products=null,u.fetch=function(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};o.activity=this.status;var n=this;a.products.list(o).then(function(t){n.products=n.products?n.products.concat(products):products,n.isEmpty=!n.products||!n.products.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(products&&products.length<e)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.products=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.products&&this.products.length?this.fetch(this.products.length/c+1,c):this.fetch(1,c)))},u}angular.module("app").factory("ActivityDetailModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,a){t.activityModel=i,t.touchActivity=function(t){r.go("activity-detail",{activity:t.id})},t.activityModel.reload()}angular.module("app").controller("ActivityController",t),t.$inject=["$scope","$http","$location","$stateParams","$state","ActivityModel","ENUM"]}(),function(){"use strict";function t(t,e){t.state("activity",{needAuth:!1,url:"/activity",title:"优惠活动",templateUrl:"modules/activity/activity.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,a,s){var c=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.activities=null,u.fetch=function(t,e){this.isLoading=!0;var o={page:t,per_page:e},n=this;n.page=t,a.activity.list(o).then(function(t){n.page<=1?n.activities=t:n.activities=n.activities?n.activities.concat(t):t,n.isEmpty=!n.activities||!n.activities.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})},u.reload=function(){this.isLoading||(this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,c))},u.loadMore=function(){this.isLoading||this.isLastPage||(this.activities&&this.activities.length?this.fetch(this.activities.length/c+1,c):this.fetch(1,c))},u.page=0,u}angular.module("app").factory("ActivityModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();