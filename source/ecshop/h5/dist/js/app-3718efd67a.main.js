!function(){"use strict";function e(e,t,o,n,r,i,a,c,s){e.username="",e.password="",e.touchSignin=function(){var t=e.username,o=e.password;!t||t.length<3?e.toast("用户名太短"):!t||t.length>25?e.toast("用户名太长"):!o||o.length<4?e.toast("请输入正确的密码"):a.auth.base.signin({username:t,password:o}).then(function(t){t?(e.toast("登录成功"),e.goHome()):e.toast("用户名或密码错误")})},e.touchSignup=function(){r.go("signup",{})},e.touchForget=function(){r.go("forget",{})},e.touchWeixin=function(){r.go("wechat-auth",{})},e.touchQQ=function(){r.go("qq-auth",{})},e.isWeixin=function(){var e=s.getConfig();return!!e&&e["wechat.web"]&&i.isWeixin()}}angular.module("app").controller("SigninController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","ENUM","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("signin",{needAuth:!1,url:"/signin",title:"用户登录",templateUrl:"modules/signin/signin.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){var t=60,o=void 0;o=u(function(){t<=0?(u.cancel(o),o=void 0,t=60,e.paracont="重发验证码",e.paraclass="mobile-code",e.paraevent=!0):(e.paracont=t+"s",e.paraclass="not-mobile-code",e.paraevent=!1,t--)},1e3,100)}e.TAB_MOBILE=0,e.TAB_EMAIL=1,e.currentTab=e.TAB_MOBILE,"mobile"==i.tab?e.currentTab=e.TAB_MOBILE:"email"==i.tab?e.currentTab=e.TAB_EMAIL:e.currentTab=e.TAB_MOBILE,e.touchTabMobile=function(){e.currentTab!=e.TAB_MOBILE&&(e.currentTab=e.TAB_MOBILE,e.signupMobile={show:!0})},e.touchTabEmail=function(){e.currentTab!=e.TAB_EMAIL&&(e.currentTab=e.TAB_EMAIL,e.signupMobile={show:!1})},e.signupMobile={show:!0},e.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},e.touchSignup=function(){var t=e.state.username,o=e.state.password,n=e.state.password2,r=e.state.email;if(!t||t.length<3)e.toast("用户名太短");else if(!t||t.length>25)e.toast("用户名太长");else if(!o||o.length<6)e.toast("请输入正确的密码");else{if(o!=n)return e.toast("请输入正确的密码"),void(e.password2="");if(!r||r.length<5)e.toast("请输入正确的邮箱地址");else{var i={};i.username=t,i.password=o,i.email=r,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth.default.signup(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("注册成功"),e.goHome()):e.toast(t.data.error_desc)})}}},e.touchSignupMobile=function(){var t=e.state.mobile,o=e.state.mobile_code,n=e.state.mobile_password,r=e.state.mobile_password2;if(!t||t.length<1)e.toast("请输入手机号码");else if(o&&6==o.length)if(!n||n.length<6)e.toast("请输入正确的密码");else{if(n!=r)return e.toast("请输入正确的密码"),void(e.password2="");var i={};i.mobile=t,i.code=o,i.password=n,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth.mobile.signup(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("手机号注册成功"),e.goHome()):e.toast(t.data.error_desc)})}else e.toast("请输入正确的手机验证码")},e.toucheMobileCode=function(){if(e.paraevent){var t=e.state.mobile;if(!t||t.length<1)e.toast("请输入手机号码");else{var o={};o.mobile=t,o.code="86",a.auth.mobile.verify(o).then(function(t){t&&a.auth.mobile.send(o).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?l():e.toast(t.data.error_desc)})})}}},e.touchLicense=function(){o.location.href=e.siteInfo.terms_url},e.siteInfo={},e.paracont="获取验证码",e.paraclass="mobile-code",e.paraevent=!0,a.site.get().then(function(t){e.siteInfo=t})}angular.module("app").controller("SignupController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function e(e,t){e.state("signup",{needAuth:!1,url:"/signup",title:"用户注册",templateUrl:"modules/signup/signup.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){var t=60,o=void 0;o=u(function(){t<=0?(u.cancel(o),o=void 0,t=60,e.paracont="重发验证码",e.paraclass="mobile-code",e.paraevent=!0):(e.paracont=t+"s",e.paraclass="not-mobile-code",e.paraevent=!1,t--)},1e3,100)}e.TAB_MOBILE=0,e.TAB_EMAIL=1,e.currentTab=e.TAB_MOBILE,"mobile"==i.tab?e.currentTab=e.TAB_MOBILE:"email"==i.tab?e.currentTab=e.TAB_EMAIL:e.currentTab=e.TAB_MOBILE,e.touchTabMobile=function(){e.currentTab!=e.TAB_MOBILE&&(e.currentTab=e.TAB_MOBILE,e.forgetMobile={show:!0})},e.touchTabEmail=function(){e.currentTab!=e.TAB_EMAIL&&(e.currentTab=e.TAB_EMAIL,e.forgetMobile={show:!1})},e.toucheMobileCode=function(){if(e.paraevent){var t=e.state.mobile;if(!t||t.length<1)e.toast("请输入手机号码");else{var o={};o.mobile=t,o.code="86",a.auth.mobile.send(o).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?l():e.toast(t.data.error_desc)})}}},e.touchforgetMobile=function(){var t=e.state.mobile,o=e.state.mobile_code,n=e.state.mobile_password,r=e.state.mobile_password2;if(!t||t.length<1)e.toast("请输入手机号码");else if(o&&6==o.length)if(!n||n.length<6)e.toast("请输入正确的密码");else{if(n!=r)return e.toast("请输入正确的密码"),void(e.password2="");var i={};i.mobile=t,i.code=o,i.password=n,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth.mobile.reset(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("找回密码成功"),e.goBack()):e.toast(t.data.error_desc)})}else e.toast("请输入正确的手机验证码")},e.touchBackLogin=function(){e.goBack()},e.forgetMobile={show:!0},e.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},e.paracont="获取验证码",e.paraclass="mobile-code",e.paraevent=!0,e.success=!1,e.email="",e.input={email:""},e.touchSendMail=function(){var t=e.input.email;!t||t.length<4?e.toast("请输入正确的邮箱"):a.auth.default.reset({email:t}).then(function(o){var n=c.ERROR_CODE.OK==o.data.error_code;e.success=n,n?e.email=t:e.toast(o.data.error_desc)})}}angular.module("app").controller("ForgetController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function e(e,t){e.state("forget",{needAuth:!1,url:"/forget",title:"找回密码",templateUrl:"modules/forget/forget.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){a.banner.list({page:1,per_page:y}).then(function(t){e.banners=t;n(function(){e.bannerSwiper=new Swiper(".home-banner",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)})}function f(){a.notice.list({page:1,per_page:A}).then(function(t){e.notices=t;n(function(){e.noticeSwiper=new Swiper(".notice-slide",{spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,direction:"vertical",loop:!0})},1)})}function g(){a.product.homeList().then(function(t){e.editorChoice=t.good_products,e.newArrival=t.recently_products,e.topSale=t.hot_products})}function m(){l.getSiteName()?u.document.title=l.getSiteName():(v(),u.document.title="ECShop"),h(),f(),g(),p.fetch(),l.getToken()&&a.bonus.get().then(function(t){if(e.bonus_info=t,e.wechatConfig&&e.bonus_info){var o=e.wechatConfig["wechat.web"];o&&$(o,e.bonus_info.shared_link)}return!0}),p.fetchWeChat().then(function(t){if(e.wechatConfig=t,t){var n=t["wechat.web"];if(n&&s.FOR_WEIXIN&&!l.getOpenId()){if(o.isWeixin())return void i.go("wechat-authbase",{})}else l.getToken()?e.wechatConfig&&e.bonus_info&&(n=e.wechatConfig["wechat.web"])&&$(n,e.bonus_info.shared_link):(n=e.wechatConfig["wechat.web"])&&$(n,u.location.protocol+"//"+u.location.host+u.location.pathname)}return!0}),e.cartModel.reloadIfNeeded()}function $(e,t){if(e){wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:e.app_id,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareWeibo","onMenuShareQQ"]});var n=t;wx.ready(function(){console.log("微信分享设置Ready");var e={title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){console.log("success".JSON.stringify(e))},cancel:function(){}};console.log(e),wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e)}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&(console.log(JSON.stringify(e)),o.toast(JSON.stringify(e)))})}}function v(){a.site.get().then(function(t){e.siteInfoName=t.name,e.siteInfoName&&l.setSiteName(e.siteInfoName)})}var y=10,A=5,T=4;e.banners=[],e.notices=[];var S={},E=[];e.wechatConfig=null,e.bonus_info=null;for(var w=0;w<T;++w)E.push(S);e.topSale=E,e.newArrival=E,e.editorChoice=E,e.touchSearch=function(){i.go("search",{})},e.touchBanner=function(t){t.link&&t.link.length?u.location.href=t.link:e.toast("没有链接")},e.touchNotice=function(e){var t="";t=-1==e.url.indexOf("http://",0)?"http://"+e.url:e.url,u.location.href=t},e.touchCategory=function(e){i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:null,category:e.id,navTitle:e.name,navStyle:"default"})},e.touchProduct=function(e){i.go("product",{product:e.id})},e.touchGroup=function(e){i.go("home",{})},e.formatUrl=function(e){var t=Math.round((new Date).getTime()/1e3);return-1==e.indexOf("?")?e+"?v="+t:e+"&v="+t},e.reload=m,e.loadMore=function(){},e.cartModel=d,e.refreshCode=function(){Math.round((new Date).getTime()/1e3)},m()}angular.module("app").controller("HomeController",e),e.$inject=["$scope","$http","$rootScope","$timeout","$location","$state","API","ENUM","CONSTANTS","$window","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("index",{needAuth:!1,url:"?token",title:"",templateUrl:"modules/home/home.html"}),e.state("home",{needAuth:!1,url:"/home",title:"",templateUrl:"modules/home/home.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){function c(){r.category.list({page:1,per_page:s}).then(function(t){t&&t.length?(e.categories=t,e.selectedSide=t[0],e.subCategories=t[0].categories):(e.categories=null,e.selectedSide=null,e.subCategories=null)})}var s=1e3;e.categories=[],e.selectedSide=null,e.touchSearch=function(){n.go("search",{})},e.touchSide=function(t){e.selectedSide=t,e.subCategories=t.categories},e.touchMain=function(t){if(t)n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:t.id,title:t.name,navTitle:t.name,navStyle:"default"});else{var o=e.selectedSide;n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:o.id,navTitle:o.name,title:o.name,navStyle:"default"})}},e.cartModel=a,c()}angular.module("app").controller("CategoryController",e),e.$inject=["$scope","$http","$location","$state","API","ENUM","CartModel"]}(),function(){"use strict";function e(e,t){e.state("category",{needAuth:!1,url:"/category",title:"商品分类",templateUrl:"modules/category/category.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.isEmpty=!1,s.isLoaded=!1,s.isLoading=!1,s.isLastPage=!1,s.total=0,s.subtotal={},s.groups=null,s.count=function(){var e=0;if(this.groups)for(var t=this.groups,o=0;o<t.length;++o)for(var n=t[o],r=0;r<n.goods.length;++r)e+=Number(n.goods[r].amount);this.total=e},s.add=function(e,t,o){if(i.getToken()){var n=this;return a.cart.add({product:e,property:JSON.stringify(t),amount:o}).then(function(e){return e&&n.reload(),e})}},s.delete=function(e){if(i.getToken()){var t=this;return a.cart.delete({good:e}).then(function(o){if(o){for(var n=t.groups,r=0;r<n.length;++r)for(var i=n[r],a=0;a<i.goods.length;++a)if(i.goods[a].id==e){i.goods.splice(a,1);break}t.isEmpty=!t.groups||!t.groups.length,t.count()}return o})}},s.update=function(e,t){if(i.getToken()){var o=this;return a.cart.update({good:e,amount:t}).then(function(n){if(n){for(var r=o.groups,i=0;i<r.length;++i)for(var a=r[i],c=0;c<a.goods.length;++c){var s=a.goods[c];if(s.id==e){s.amount=t;break}}o.isEmpty=!o.groups||!o.groups.length,o.count()}return n})}},s.reload=function(){if(!i.getToken())return this.total=0,void(s.total=0);var e=this;return a.cart.get({}).then(function(t){return t&&(e.groups=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1,e.count()),a.order.subtotal().then(function(t){e.subtotal=t}),!!t})},s.reloadIfNeeded=function(){this.reload()},s}angular.module("app").factory("CartModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){for(var t=0,o=0,n=e.selectedGoods,r=0;r<n.length;++r)t+=Number(n[r].amount),o+=n[r].amount*n[r].price;e.selectedAmount=t,e.selectedPrice=o}e.showDialog=!1,e.deletingGoods=null,e.touchDelete=function(t){e.deletingGoods=t,e.showDialog=!0},e.touchDialogCancel=function(){e.showDialog=!1,e.deletingGoods=null},e.touchDialogConfirm=function(){e.deletingGoods&&e.cartModel.delete(e.deletingGoods.id).then(function(t){if(t){for(var o=e.selectedGoods,n=0;n<o.length;++n)if(o[n].id==e.deletingGoods.id){o.splice(n,1);break}e.toast("删除成功"),e.showDialog=!1,e.deletingGoods=null,a()}})},e.touchProduct=function(e){n.go("product",{product:e.id})},e.touchSubmit=function(){e.selectedGoods&&e.selectedGoods.length?(r.clear(),r.goods=e.selectedGoods,n.go("confirm-cart",{})):e.toast("请先选择商品")},e.touchAmountSub=function(t){t.amount<=1||e.cartModel.update(t.id,Number(t.amount)-1).then(function(e){a()})},e.touchAmountAdd=function(t){e.cartModel.update(t.id,Number(t.amount)+1).then(function(e){a()})},e.touchSelect=function(t){for(var o=e.selectedGoods,n=-1,r=0;r<o.length;++r)if(o[r].id==t.id){n=r;break}-1==n?o.push(t):o.splice(n,1),a()},e.touchSelectAll=function(){var t=e.cartModel.groups,o=[],n=!e.isSelectedAll;if(n)for(var r=0;r<t.length;++r)for(var i=t[r],c=0;c<i.goods.length;++c){var s=i.goods[c];o.push(s)}e.selectedGoods=o,e.isSelectedAll=n,a()},e.isSelected=function(t){for(var o=e.selectedGoods,n=0;n<o.length;++n)if(t.id==o[n].id)return!0;return!1},e.isSelectedAll=!1,e.selectedGoods=[],e.selectedAmount=0,e.selectedPrice=0,e.cartModel=i,e.cartModel.reload()}angular.module("app").controller("CartController",e),e.$inject=["$scope","$http","$location","$state","ConfirmCartService","CartModel"]}(),function(){"use strict";function e(e,t){e.state("cart",{needAuth:!0,url:"/cart",title:"购物车",templateUrl:"modules/cart/cart.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t){e.state("cart-select",{needAuth:!0,url:"/cart-select",title:"购物车",templateUrl:"modules/cart-select/cart-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){l()&&i.user.profileGet().then(function(t){a.setUser(t),e.user=t,t.nickname?e.userName=t.nickname:e.userName=t.username})}function l(){return a.getToken()}e.touchAllOrders=function(){r.go("my-order",{tab:"all"})},e.touchOrderCreated=function(){r.go("my-order",{tab:"created"})},e.touchOrderPayed=function(){r.go("my-order",{tab:"paid"})},e.touchOrderDelivering=function(){r.go("my-order",{tab:"delivering"})},e.touchOrderDelivered=function(){r.go("my-order",{tab:"delivered"})},e.touchFav=function(){r.go("my-favorite",{})},e.touchAddress=function(){r.go("my-address",{})},e.touchScore=function(){r.go("my-score",{tab:"all"})},e.touchCashGift=function(){r.go("my-cashgift",{})},e.touchHelps=function(){r.go("article",{})},e.touchPassword=function(){r.go("change-password",{})},e.touchSignin=function(){a.getToken()||e.goSignin()},e.touchSignout=function(){a.getToken()&&i.auth.base.signout().then(function(t){t?(e.goHome(),e.toast("注销成功")):e.toast("注销失败")})},e.touchBonus=function(){r.go("bonus",{})},e.touchBalance=function(){r.go("my-balance",{})},e.isSignIn=l,e.isWeixin=function(){return o.isWeixin()},e.cartModel=c,e.user=a.getUser(),e.userName="",s.fetch();var d=s.getConfig();e.authorize=d.authorize,u(),e.cartModel.reloadIfNeeded()}angular.module("app").controller("ProfileController",e),e.$inject=["$scope","$http","$rootScope","$location","$state","API","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("profile",{needAuth:!0,url:"/profile",title:"个人中心",templateUrl:"modules/profile/profile.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a={};return a.history=null,a.clear=function(){this.history=null},i.$on("searchChanged",function(e,t){t&&t.length&&-1==(a.history?a.history.indexOf(t):-1)&&(a.history=a.history||[],a.history.push(t))}),a}angular.module("app").factory("SearchService",e),e.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){a.search.keywordList({}).then(function(t){e.keywords=t})}e.currentKeyword="",e.keywords=null,e.history=s.history,e.touchSearch=function(){!e.currentKeyword||e.currentKeyword.length<1?e.toast("请输入正确的关键字"):(r.$emit("searchChanged",e.currentKeyword),i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:e.currentKeyword,category:null,navTitle:e.currentKeyword,navStyle:"search"}))},e.touchKeyword=function(t){!t||t.length<1?e.toast("请输入正确的关键字"):(e.currentKeyword=t,r.$emit("searchChanged",t),i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:t,category:null,navTitle:t,navStyle:"search"}))},u()}angular.module("app").controller("SearchController",e),e.$inject=["$scope","$http","$window","$timeout","$rootScope","$state","API","ENUM","SearchService"]}(),function(){"use strict";function e(e,t){e.state("search",{needAuth:!1,url:"/search",title:"搜索",templateUrl:"modules/search/search.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.isLoading||(e.products=null,e.isEmpty=!1,e.isLoaded=!1,d(1,p))}function d(t,o){e.isLoading=!0;var n={};e.currentCategory&&(n.category=e.currentCategory),e.currentKeyword&&(n.keyword=e.currentKeyword),n.sort_key=e.currentSortKey,n.sort_value=e.currentSortValue,n.page=t,n.per_page=o,s.product.list(n).then(function(t){e.products=e.products?e.products.concat(t):t,e.isEmpty=!e.products||!e.products.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!!(t&&t.length<o)&&!e.isEmpty})}var p=10;e.currentSortKey=c.sortKey?c.sortKey:u.SORT_KEY.DEFAULT,e.currentSortValue=c.sortValue?c.sortValue:u.SORT_KEY.DESC,e.currentKeyword=c.keyword?c.keyword:null,e.currentCategory=c.category,e.navTitle=c.navTitle,e.navStyle=c.navStyle,e.navStyle||(e.navStyle="default"),e.products=null,e.touchSearch=function(){l()},e.touchSortDefault=function(){var t=u.SORT_KEY.DEFAULT,o=u.SORT_VALUE.DEFAULT;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,l())},e.touchSortSale=function(){var t=u.SORT_KEY.SALE,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,l())},e.touchSortDate=function(){var t=u.SORT_KEY.DATE,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,l())},e.touchSortPrice=function(){var t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC;e.currentSortKey==u.SORT_KEY.PRICE?e.currentSortValue==u.SORT_VALUE.DEFAULT||e.currentSortValue==u.SORT_VALUE.ASC?(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC):(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.ASC):(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC),t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,l())},e.touchSortCredit=function(){var t=u.SORT_KEY.CREDIT,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,l())},e.touchProduct=function(e){a.go("product",{product:e.id})},e.loadMore=function(){if(!e.isLoading&&!e.isLastPage)if(e.products&&e.products.length){if(e.products.length%10)return;d(e.products.length/p+1,p)}else d(1,p)},e.isEmpty=!1,e.isLoaded=!1,e.isLoading=!1,e.isLastPage=!1,r.height&&$("html, body").animate({scrollTop:r.height},500),l()}angular.module("app").controller("SearchResultController",e),e.$inject=["$scope","$http","$window","$timeout","SearchResultModel","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("search-result",{needAuth:!1,url:"/search-result/?keyword&sortKey&sortValue&category&navTitle&navStyle",title:"搜索结果",templateUrl:"modules/search-result/search-result.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.height=0,s.products=[],s}angular.module("app").factory("SearchResultModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){var t=[].concat(e.currentAttrs).concat(e.optionalAttrs);e.currentSelectedPrice=parseFloat(e.product.current_price);for(var o=0;o<e.product.properties.length;++o){var n=e.product.properties[o];for(var r in n.attrs)-1!=t.indexOf(n.attrs[r].id)&&n.attrs[r].attr_price&&(e.currentSelectedPrice+=parseFloat(n.attrs[r].attr_price))}}function f(){var t=e.product,o=!1;if(!t||!t.good_stock)return!1;for(var n in t.properties)if(!t.properties[n].is_multiselect){o=!0;break}if(o){if(!e.currentAttrs||!e.currentAttrs.length)return!1;if(!g([].concat(e.currentAttrs)))return!1;if(!e.currentStock)return!1}return!0}function g(t){for(var o=0;o<e.product.stock.length;o++){var n=e.product.stock[o],r=n.goods_attr.split("|");r.sort(function(e,t){return e-t});for(var i=0;i<t.length;i++){var a=t[i];t[i]=a.toString()}if(t.sort(function(e,t){return e-t}),m(r,t)&&n.stock_number>0)return!0}return!1}function m(e,t){if(e.length<t.length)return!1;for(var o=0,n=t.length;o<n;o++)if(-1==e.indexOf(t[o]))return!1;return!0}function $(){e.isLoading=!0,c.product.get({product:T}).then(function(t){if(t.properties.sort(function(e,t){return e.is_multiselect-t.is_multiselect}),e.product=t,e.isLoaded=!0,e.isLoading=!1,e.canPurchase=f(),p.fetchWeChat().then(function(t){if(t){var o=t["wechat.web"];o&&v(o,e.product)}}),t.photos&&t.photos.length>1)n(function(){e.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1);else n(function(){e.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!1,spaceBetween:30,centeredSlides:!0,autoplay:0,autoplayDisableOnInteraction:!1,loop:!1})},1);for(var o=[],r=null,i=0;i<t.stock.length;i++){var a=t.stock[i];if(a.stock_number>0){for(var c=a.goods_attr.split("|"),i=0;i<c.length;i++){var s=c[i];o.push(parseInt(s))}o.sort(function(e,t){return e-t});break}}if(o.length)for(var u=o.join("|"),i=0;i<t.stock.length;++i){var l=t.stock[i].goods_attr.split("|");if(l.sort(function(e,t){return e-t}),l.join("|")==u){r=t.stock[i];break}}e.currentAttrs=o,e.currentStock=r,e.canPurchase=f(),h(),y()})}function v(e,t){if(e){var o=t.share_url?t.share_url:t.share_link;wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:e.app_id,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}})}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&$rootScope.toast(JSON.stringify(e))})}}function y(){e.product&&c.review.productList({product:T,grade:s.REVIEW_GRADE.ALL,page:1,per_page:A}).then(function(t){e.comments=t})}var A=3,T=a.product;e.currentStock=null,e.currentAttrs=[],e.currentSelectedPrice=0,e.input={currentAmount:1},e.optionalAttrs=[],e.canPurchase=!1,e.product=null,e.comments=[],e.cartModel=d,e.touchAmountSub=function(){if(f()&&e.product&&(!e.product.stock||!e.product.stock.length||e.currentStock)){var t=parseInt(e.input.currentAmount);t<=1?e.toast("受不了了，宝贝不能再少了"):e.input.currentAmount=t-1}},e.touchAmountAdd=function(){if(f()&&e.product)if(e.product.stock&&e.product.stock.length){if(!e.currentStock)return;if((t=parseInt(e.input.currentAmount))>=(o=parseInt(e.currentStock.stock_number)))return void e.toast("达到最大库存");e.input.currentAmount=t+1}else{var t=parseInt(e.input.currentAmount),o=e.product.good_stock;if(t>=o)return;e.input.currentAmount=t+1}},e.touchAttr=function(t,o){if(e.product){var n=e.product;if(o.is_multiselect)-1==(a=(i=[].concat(e.optionalAttrs)).indexOf(o.id))?i.push(o.id):i.splice(a,1),e.optionalAttrs=i,h();else{var r=null,i=[].concat(e.currentAttrs),a=i.indexOf(o.id);for(var c in t.attrs)t.attrs[c].id!=o.id&&-1!=(a=i.indexOf(t.attrs[c].id))&&i.splice(a,1);if(i.push(o.id),(i=i.filter(function(e,t,o){return o.indexOf(e)===t})).sort(function(e,t){return e-t}),i.length)for(var s=i.join("|"),c=0;c<n.stock.length;++c){var u=n.stock[c].goods_attr.split("|");if(u.sort(function(e,t){return e-t}),u.join("|")==s){r=n.stock[c];break}}e.currentAttrs=i,e.currentStock=r,e.canPurchase=f(),h()}}},e.touchLike=function(){u.getToken()?e.product.is_liked?(e.product.is_liked=!1,c.product.unlike({product:T}).then(function(t){e.product.is_liked=t,e.toast("取消收藏")},function(t){e.product.is_liked=!0})):(e.product.is_liked=!0,c.product.like({product:T}).then(function(t){e.product.is_liked=t,e.toast("收藏成功")},function(t){e.product.is_liked=!1})):e.goSignin()},e.touchComments=function(){i.go("comment",{product:T})},e.touchComment=function(e){i.go("comment",{product:T})},e.touchCart=function(){u.getToken()?i.go("cart-select",{}):e.goSignin()},e.touchAddCart=function(){if(f())if(u.getToken()){var t=[].concat(e.currentAttrs).concat(e.optionalAttrs),o=Number(e.input.currentAmount);d.add(T,t,o).then(function(t){t&&e.toast("已添加到购物车")})}else e.goSignin()},e.touchPurchase=function(){if(f())if(u.getToken()){var t=e.product,o=[].concat(e.currentAttrs).concat(e.optionalAttrs),n=Number(e.input.currentAmount);l.clear(),l.product=t,l.attrs=o,l.amount=n,i.go("confirm-product",{})}else e.goSignin()},e.refreshAmount=function(){var t=parseInt(e.input.currentAmount),o=parseInt(e.currentStock.stock_number);t>o&&(e.toast("达到最大库存"),e.input.currentAmount=o),t<1&&(e.input.currentAmount=1)},e.formatGrade=function(e){return s.REVIEW_GRADE.BAD==e?"差评":s.REVIEW_GRADE.MEDIUM==e?"中评":s.REVIEW_GRADE.GOOD==e?"好评":"中评"},e.isAttrSelected=function(t){return t.is_multiselect?-1==e.optionalAttrs.indexOf(t.id)?"unSelected":"selected":-1==e.currentAttrs.indexOf(t.id)?"unSelected":"selected"},e.isLoading=!1,e.isLoaded=!1,$()}angular.module("app").controller("ProductController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","ConfirmProductService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("product",{needAuth:!1,url:"/product?product",title:"商品详情",templateUrl:"modules/product/product.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(t,o){var n=s.REVIEW_GRADE.ALL;e.currentTab==e.TAB_ALL?n=s.REVIEW_GRADE.ALL:e.currentTab==e.TAB_BAD?n=s.REVIEW_GRADE.BAD:e.currentTab==e.TAB_MEDIUM?n=s.REVIEW_GRADE.MEDIUM:e.currentTab==e.TAB_GOOD&&(n=s.REVIEW_GRADE.GOOD),e.isLoading=!0,c.review.productList({product:p,grade:n,page:t,per_page:o}).then(function(t){e.comments=e.comments?e.comments.concat(t):t,e.isEmpty=!e.comments||!e.comments.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!!(t&&t.length<o)&&!e.isEmpty})}function l(){e.isLoading||(e.comments=null,e.isEmpty=!1,e.isLoaded=!1,u(1,d))}var d=10,p=a.product;e.TAB_ALL=0,e.TAB_BAD=1,e.TAB_MEDIUM=2,e.TAB_GOOD=3,e.currentPage=0,e.currentTab=e.TAB_ALL,e.comments=null,e.touchTabAll=function(){e.currentTab=e.TAB_ALL,l()},e.touchTabBad=function(){e.currentTab=e.TAB_BAD,l()},e.touchTabMedium=function(){e.currentTab=e.TAB_MEDIUM,l()},e.touchTabGood=function(){e.currentTab=e.TAB_GOOD,l()},e.loadMore=function(){e.isLoading||e.isLastPage||(e.comments&&e.comments.length?u(e.comments.length/d+1,d):u(1,d))},e.formatGrade=function(e){return s.REVIEW_GRADE.BAD==e?"差评":s.REVIEW_GRADE.MEDIUM==e?"中评":s.REVIEW_GRADE.GOOD==e?"好评":"中评"},e.isEmpty=!1,e.isLoaded=!1,e.isLoading=!1,e.isLastPage=!1,l()}angular.module("app").controller("CommentController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("comment",{needAuth:!1,url:"/comment/?product",title:"商品评价",templateUrl:"modules/comment/comment.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a={};return a.goods=[],a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.express=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.clear=function(){this.goods=[],this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},a.input={score:0,comment:""},n.$on("consigneeChanged",function(e,t){a.consignee=t}),n.$on("expressChanged",function(e,t){a.express=t}),n.$on("invoiceChanged",function(e,t){a.invoiceTitle=t.title,a.invoiceType=t.type,a.invoiceContent=t.content}),n.$on("cashgiftChanged",function(e,t){a.cashgift=t}),a}angular.module("app").factory("ConfirmCartService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){var t={};c.consignee.list(t).then(function(t){if(t&&(e.consigneeList=t,!e.consignee))for(var o in e.consigneeList)e.consigneeList[o].is_default&&(e.consignee=e.consigneeList[o],r.$emit("consigneeChanged",e.consignee))})}function f(){e.maxUseScore=0;for(var t=0;t<e.goods.length;++t)e.maxUseScore+=e.goods[t].product.score*e.goods[t].amount;c.score.get({}).then(function(t){e.scoreInfo=t,e.refreshScore()})}function g(){var t=e.goods,o=e.consignee,n=e.express,r=e.coupon,i=e.cashgift,a=e.input.score;if(t&&t.length){if(o){for(var s=[],u=0;u<t.length;++u)s.push({goods_id:t[u].product.id,property:t[u].attrs.split(","),num:t[u].amount});var l={};l.order_product=JSON.stringify(s),o&&(l.consignee=o.id),n&&(l.shipping=n.id),i&&(l.cashgift=i.id),r&&(l.coupon=r.id),a&&(l.score=a),c.order.price(l).then(function(t){e.priceInfo=t,e.all_discount=t.discount_price;for(var o in t.promos)e.all_discount+=parseFloat(t.promos[o].price)})}}else e.toast("商品信息不存在")}u.goods&&u.goods.length?(e.touchAddress=function(){n.go("address-select",{address:e.consignee?e.consignee.id:null})},e.touchExpress=function(){if(e.consignee){for(var t=e.goods,o=[],r=[],i=[],a=0;a<t.length;++a)o.push(t[a].product.id),r.push(t[a].amount),i.push(t[a].attrs.split(","));l.clear(),l.expressId=e.express?e.express.id:null,l.goodsIds=o,l.goodsNumbers=r,l.region=e.consignee.id,l.propertys=i,n.go("express-select",{})}else e.toast("请选择地址")},e.touchInvoice=function(){d.clear(),d.type=e.invoiceType?e.invoiceType:null,d.title=e.invoiceTitle,d.content=e.invoiceContent?e.invoiceContent:null,n.go("invoice-select",{})},e.touchCashgift=function(){var t=e.goods,o=(e.consignee,e.express,e.cashgift),r=0;for(var i in t)r+=t[i].price;n.go("cashgift-select",{cashgift:o?o.id:null,total:r})},e.touchSubmit=function(){var t=e.goods,o=e.consignee,r=e.express,i=e.coupon,a=e.cashgift,s=e.input.score,d=e.input.comment,h=e.invoiceType,f=e.invoiceTitle,g=e.invoiceContent,m=[];if(t&&t.length){for(var $=0;$<t.length;++$)m.push(t[$].id);if(m&&m.length)if(o)if(r){var v={shop:1,consignee:o?o.id:null,cart_good_id:m?JSON.stringify(m):null,shipping:r?r.id:null,invoice_type:h?h.name:null,invoice_title:f,invoice_content:g?g.name:null,coupon:i?i.id:null,cashgift:a?a.id:null,score:s,comment:d};c.cart.checkout(v).then(function(e){e&&(u.clear(),l.clear(),p.clear(),p.order=e,n.go("payment",{order:e.id}))})}else e.toast("请选择快递");else e.toast("请填写地址");else e.toast("商品信息不存在")}else e.toast("商品信息不存在")},e.refreshScore=function(){e.timer&&(i.cancel(e.timer),e.timer=null),e.timer=i(function(){var t=e.scoreInfo.score>e.maxUseScore?e.maxUseScore:e.scoreInfo.score;e.input.score>t&&(e.input.score=t),e.input.score<0&&(e.input.score=0),u.input.score=e.input.score,g(),e.timer=null},200)},e.refreshComment=function(){u.input.comment=e.input.comment},e.goods=u.goods,e.consignee=u.consignee,e.invoiceType=u.invoiceType,e.invoiceTitle=u.invoiceTitle,e.invoiceContent=u.invoiceContent,e.cashgift=u.cashgift,e.express=u.express,e.coupon=u.coupon,e.all_discount=0,e.input={score:0,comment:""},e.input.score=u.input.score,0==e.input.score&&(e.input.score=""),e.input.comment=u.input.comment,e.scoreInfo=null,e.priceInfo=null,e.canPurchase=!!(e.goods&&e.goods.length&&e.consignee&&e.express),e.maxUseScore=0,e.formatPromo=function(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"},g(),f(),h()):i(function(){r.goHome()},1)}angular.module("app").controller("ConfirmCartController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","ConfirmCartService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("confirm-cart",{needAuth:!0,url:"/confirm-cart",templateUrl:"modules/confirm-cart/confirm-cart.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a={};return a.product=null,a.properties=null,a.amount=null,a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.shippingVendor=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.express=null,a.clear=function(){this.product=null,this.properties=null,this.amount=null,this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},a.input={score:0,comment:""},i.$on("consigneeChanged",function(e,t){a.consignee=t}),i.$on("expressChanged",function(e,t){a.express=t}),i.$on("invoiceChanged",function(e,t){a.invoiceTitle=t.title,a.invoiceType=t.type,a.invoiceContent=t.content}),i.$on("cashgiftChanged",function(e,t){a.cashgift=t}),a}angular.module("app").factory("ConfirmProductService",e),e.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){if(e.consignee){var t=[];for(var o in e.selectedGoods){var n=e.selectedGoods[o],i={goods_id:n.product.id,property:n.attrs,num:n.amount,total_amount:n.amount};t.push(i)}var a={};a.order_product=JSON.stringify(t),e.consignee&&(a.consignee=e.consignee.id),e.express&&(a.shipping=e.express.id),e.cashgift&&(a.cashgift=e.cashgift.id),e.coupon&&(a.coupon=e.coupon.id),e.input.score&&(a.score=e.input.score),r.order.price(a).then(function(t){if(t){e.priceInfo=t,e.all_discount=t.discount_price;for(var o in t.promos)e.all_discount+=parseFloat(t.promos[o].price)}})}}if(e.touchAddress=function(){t.go("address-select",{address:e.consignee?e.consignee.id:null})},e.touchExpress=function(){if(e.consignee){var o=[],n=[],r=[];for(var i in e.selectedGoods){var c=e.selectedGoods[i];o.push(c.product.id),n.push(c.amount);var s=c.attrs[0],u=[];s?u.push(s.toString()):u.push(""),r.push(u)}a.clear(),a.expressId=e.express?e.express.id:null,a.goodsIds=o,a.goodsNumbers=n,a.region=e.consignee.id,a.propertys=r,t.go("express-select",{})}else e.toast("请选择地址")},e.touchInvoice=function(){c.clear(),c.type=e.invoiceType?e.invoiceType:null,c.title=e.invoiceTitle,c.content=e.invoiceContent?e.invoiceContent:null,t.go("invoice-select",{})},e.touchCashgift=function(){t.go("cashgift-select",{cashgift:e.cashgift?e.cashgift.id:null,total:e.priceInfo?e.priceInfo.product_price:0})},e.touchSubmit=function(){var o=e.consignee,n=e.express;if(o)if(n){var c={};for(var u in e.selectedGoods){var l=e.selectedGoods[u];c.product=l.product.id,c.property=JSON.stringify(l.attrs),c.amount=l.amount}e.consignee&&(c.consignee=e.consignee.id),e.express&&(c.shipping=e.express.id),e.cashgift&&(c.cashgift=e.cashgift.id),e.input.score&&(c.score=e.input.score),e.invoiceContent&&(c.invoice_content=e.invoiceContent.name),e.invoiceType&&(c.invoice_type=e.invoiceType.name),e.invoiceTitle&&(c.invoice_title=e.invoiceTitle),e.input.comment&&(c.comment=e.input.comment),r.product.purchase(c).then(function(e){e&&(i.clear(),a.clear(),s.clear(),s.order=e,t.go("payment",{order:e.id}))})}else e.toast("请选择快递");else e.toast("请填写地址")},e.refreshScore=function(){var t=e.scoreInfo.score>e.maxUseScore?e.maxUseScore:e.scoreInfo.score;e.input.score>t&&(e.input.score=t),e.input.score<0&&(e.input.score=0),i.input.score=e.input.score,u()},e.refreshComment=function(){i.input.comment=e.input.comment},e.consigneeList=[],e.consignee=i.consignee,e.invoiceType=i.invoiceType,e.invoiceTitle=i.invoiceTitle,e.invoiceContent=i.invoiceContent,e.cashgift=i.cashgift,e.express=i.express,e.coupon=i.coupon,e.all_discount=0,e.input={score:0,comment:""},e.input.score=i.input.score,e.input.comment=i.input.comment,0==e.input.score&&(e.input.score=""),e.rule="",e.scoreInfo=null,e.priceInfo={},e.canPurchase=function(){return!!(e.selectedGoods&&e.selectedGoods.length&&e.consignee&&e.express)},e.formatPromo=function(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"},e.maxUseScore=0,e.selectedGoods=[],i.product){var l={};l.product=i.product;var d=i.attrs;l.property="",l.attrs=[];for(var p=parseFloat(l.product.current_price),h=d.length,f=0;f<h;f++)for(var g=l.product.properties.length,m=0;m<g;m++)for(var $=l.product.properties[m],v=$.attrs.length,y=0;y<v;y++){var A=$.attrs[y];parseInt(A.id)==d[f]&&(l.property.length>0?l.property+=","+A.attr_name:l.property=A.attr_name,l.attrs.push(A.id),p+=parseFloat(A.attr_price))}l.amount=i.amount,l.price=p,e.selectedGoods.push(l),function(){var t={};r.consignee.list(t).then(function(t){if(t&&(e.consigneeList=t,!e.consignee)){for(var n in e.consigneeList)e.consigneeList[n].is_default&&(e.consignee=e.consigneeList[n],o.$emit("consigneeChanged",e.consignee));u()}})}(),function(){e.maxUseScore=0;for(var t=0;t<e.selectedGoods.length;++t)e.maxUseScore+=e.selectedGoods[t].product.score*e.selectedGoods[t].amount;r.score.get({}).then(function(t){e.scoreInfo=t})}(),u()}}angular.module("app").controller("ConfirmController",e),e.$inject=["$scope","$state","$rootScope","$stateParams","API","ConfirmProductService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("confirm-product",{needAuth:!0,url:"/confirm-product",title:"确认订单",templateUrl:"modules/confirm-product/confirm-product.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.isEmpty=!1,s.isLoaded=!1,s.isLoading=!1,s.types=null,s.order=null,s.reload=function(){if(i.getToken()){var e=this;return a.payment.typeList({}).then(function(t){return t&&(e.types=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1),!!t})}},s.clear=function(){this.order=null},s}angular.module("app").factory("PaymentModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){u.order?(e.selectedType=null,e.paymentModel=u,e.isSelected=function(t){return!!e.selectedType&&t.code==e.selectedType.code},e.touchSelect=function(t){e.selectedType=t},e.touchSubmit=function(){if(e.selectedType)switch(e.selectedType.code){case"alipay.app":case"alipay.wap":n.go("alipay-wap",{order:u.order.id});break;case"wxpay.app":case"wxpay.web":r.isWeixin()?n.go("wechat-pay",{order:u.order.id}):e.toast("暂不支持此方式");break;case"unionpay.app":e.toast("暂不支持此方式");break;case"teegon.wap":n.go("teegon",{order:u.order.id});break;default:e.toast("暂不支持此方式")}else e.toast("请选择支持方式")},e.touchDetail=function(){n.go("order-detail",{order:e.paymentModel.order.id})},e.paymentModel.reload().then(function(e){})):i(function(){r.goHome()},1)}angular.module("app").controller("PaymentController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("payment",{needAuth:!1,url:"/payment",title:"收银台",templateUrl:"modules/payment/payment.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("payment-success",{needAuth:!0,url:"/payment-success?order",title:"付款成功",templateUrl:"modules/payment-success/payment-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.reason=r.reason,e.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentFailedController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("payment-failed",{needAuth:!0,url:"/payment-failed?order&reason",title:"支付失败",templateUrl:"modules/payment-failed/payment-failed.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a={};return a.title=null,a.type=null,a.content=null,a.clear=function(){this.title=null,this.type=null,this.content=null},a}angular.module("app").factory("InvoiceSelectService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.invoice.typeList({}).then(function(t){for(var o=new Array,n=0;n<t.length;n++){var r=t[n];r.name.length&&o.push(r)}e.types=o;var i=e.selectedType;if(i)for(n=0;n<t.length;++n)if(t[n].id==i.id){e.selectedType=t[n];break}e.noInvoice=l()})}function u(){i.invoice.contentList({}).then(function(t){e.contents=t;var o=e.selectedContent;if(o)for(var n=0;n<t.length;++n)if(t[n].id==o.id){e.selectedContents=t[n];break}e.noInvoice=l()})}function l(){return(!e.input.title||!e.input.title.length)&&(!e.selectedType&&!e.selectedContent)}e.input={title:c.title},e.selectedType=c.type,e.selectedContent=c.content,e.types=null,e.contents=null,e.touchType=function(t){e.selectedType=t,e.noInvoice=!1},e.touchContent=function(t){e.selectedContent=t,e.noInvoice=!1},e.touchConfirm=function(){if(e.noInvoice)o.$emit("invoiceChanged",{title:null,type:null,content:null}),e.goBack();else{if(!e.types)return void e.toast("请选择发票类型");if(!e.contents)return void e.toast("请选择发票明细");if(!e.input.title||!e.input.title.length)return void e.toast("请填写发票抬头");o.$emit("invoiceChanged",{title:e.input.title,type:e.selectedType,content:e.selectedContent}),e.goBack()}},e.touchToggle=function(){e.noInvoice=!e.noInvoice,e.noInvoice&&(e.input.title=null,e.selectedType=null,e.selectedContent=null)},e.noInvoice=l(),s(),u()}angular.module("app").controller("InvoiceSelectController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$state","API","ENUM","InvoiceSelectService"]}(),function(){"use strict";function e(e,t){e.state("invoice-select",{needAuth:!0,url:"/invoice-select",title:"发票信息",templateUrl:"modules/invoice-select/invoice-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a={};return a.expressId=null,a.goodsIds=null,a.goodsNumbers=null,a.region=null,a.clear=function(){this.expressId=null,this.goodsIds=null,this.goodsNumbers=null,this.region=null,this.propertys=null},a.propertys=null,a}angular.module("app").factory("ExpressSelectService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){e.selectedId=s.expressId||null,e.goodsIds=s.goodsIds||[],e.propertys=s.propertys||[],e.goodsNumbers=s.goodsNumbers||[],e.region=s.region||null,e.vendors=[],e.touchVendor=function(t){n.$emit("expressChanged",t),e.goBack()},function(){for(var t=e.goodsIds,o=e.goodsNumbers,n=e.propertys,r=[],i=0;i<t.length&&i<o.length;++i)r.push({goods_id:t[i],property:n[i],num:o[i]});var c=[];for(var s in e.selectedGoods){var u=e.selectedGoods[s],l={goods_id:u.product.id,num:u.amount};c.push(l)}a.shipping.vendorList({shop:1,products:JSON.stringify(r),address:e.region}).then(function(t){e.vendors=t})}()}angular.module("app").controller("ExpressSelectController",e),e.$inject=["$scope","$http","$window","$rootScope","$state","$stateParams","API","ENUM","ExpressSelectService"]}(),function(){"use strict";function e(e,t){e.state("express-select",{needAuth:!0,url:"/express-select",title:"配送方式",templateUrl:"modules/express-select/express-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.cashgifts=null,u.totalPrice=0,u.clear=function(){this.cashgifts=null,this.totalPrice=0},u.fetch=function(e,t){if(c.getToken()){this.isLoading=!0;var o=this;i.cashgift.available({total_price:this.totalPrice,page:e,per_page:t}).then(function(e){o.cashgifts=o.cashgifts?o.cashgifts.concat(e):e,o.isEmpty=!o.cashgifts||!o.cashgifts.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(e&&e.length<t)&&!o.isEmpty})}},u.reload=function(){c.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.fetch(1,s)))},u.loadMore=function(){c.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/s+1,s):this.fetch(1,s)))},u}angular.module("app").factory("CashgiftSelectModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.selectedId=i.cashgift||null,e.totalPrice=i.total||0,e.cashgiftSelectModel=u,e.cashgiftSelectModel.clear(),e.cashgiftSelectModel.totalPrice=e.totalPrice,e.touchClear=function(){e.selectedId=null},e.touchCashgift=function(t){e.selectedId=t.id},e.touchConfirm=function(){var t=null,o=e.cashgiftSelectModel.cashgifts;for(var n in o)if(o[n].id==e.selectedId){t=o[n];break}r.$emit("cashgiftChanged",t),e.goBack()},e.cashgiftSelectModel.reload()}angular.module("app").controller("CashgiftSelectController",e),e.$inject=["$scope","$http","$location","$timeout","$rootScope","$stateParams","$state","API","ENUM","CashgiftSelectModel"]}(),function(){"use strict";function e(e,t){e.state("cashgift-select",{needAuth:!0,url:"/cashgift-select?cashgift&total",title:"选择红包",templateUrl:"modules/cashgift-select/cashgift-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){var c={};return c.isLoading=!1,c.isLoaded=!1,c.consignees=null,c.clear=function(){this.consignees=null},c.reload=function(){this.isLoading=!1,this.isLoaded=!1;var e=this;return i.consignee.list({}).then(function(t){e.consignees=t,e.isLoading=!1,e.isLoaded=!0})},c}angular.module("app").factory("AddressSelectModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){e.selectedId=o.address,e.addressSelectModel=s,e.touchCreate=function(){e.addressEditModel.clear(),e.addressEditModel.consignee=null,r.go("address-edit",{})},e.touchModify=function(t){e.addressEditModel.clear(),e.addressEditModel.consignee=t,r.go("address-edit",{})},e.touchConsignee=function(t){n.$emit("consigneeChanged",t),e.goBack()},e.touchDefaultAddress=function(t){i.consignee.setDefault({consignee:t.id}).then(function(o){if(o)for(var n=0;n<e.myAddressModel.consignees.length;n++){var r=e.myAddressModel.consignees[n];r.id==t.id?r.is_default=!0:r.is_default=!1}else e.toast("设置失败")})},e.isDefaultAddress=function(e){return!!e.is_default},e.addressEditModel=c,e.goMyAddress=function(){r.go("my-address",{})},e.addressSelectModel.clear(),e.addressSelectModel.reload()}angular.module("app").controller("AddressSelectController",e),e.$inject=["$scope","$http","$stateParams","$rootScope","$state","API","ENUM","AddressEditModel","AddressSelectModel"]}(),function(){"use strict";function e(e,t){e.state("address-select",{needAuth:!0,url:"/address-select?address",title:"选择地址",templateUrl:"modules/address-select/address-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){if(c.getToken()&&!this.isLoading){this.isLoading=!0;var e=this;return i.region.list({}).then(function(t){return t&&t.length?(e.isLoading=!1,e.isLoaded=!0,e.regions=t):$scope.toast("没有可选地址"),!!t})}}var u={};return u.isLoaded=!1,u.isLoading=!1,u.consignee=null,u.regions=null,u.save=function(e,t,o,n){if(c.getToken()){if(this.consignee&&this.consignee.id)return r=this,i.consignee.update({consignee:this.consignee.id,name:e,mobile:t,tel:t,zip_code:"",region:o,address:n}).then(function(e){return r.consignee=e,!!e});var r=this;return i.consignee.add({name:e,mobile:t,tel:t,zip_code:"",region:o,address:n}).then(function(e){return r.consignee=e,!!e})}},u.clear=function(){this.consignee=null},u.reload=s,u.reload=s,u.reloadIfNeeded=function(){if(c.getToken()){if(this.isLoaded){var e=t.defer();return o(function(){e.resolve(!0)},1),e.promise}return this.reload()}},u}angular.module("app").factory("AddressEditModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(e){for(var t="",o=0;o<e.length;++o)t+=e[o].name,t+=" ";return t}e.touchSave=function(){var t=e.name,o=e.mobile,n=e.address,r=e.regions;if(!t||t.length<2)e.toast("请输入姓名");else if(!o||o.length<5)e.toast("请输入电话");else if(r&&r.length){var i=r[r.length-1];i?!n||n.length<1?e.toast("请输入地址"):e.allowSave&&(e.allowSave=!1,e.addressEditModel.save(t,o,i.id,n).then(function(t){e.allowSave=!0,t?(e.toast("保存成功"),e.goBack()):e.toast("请稍后再试")})):e.toast("请选择地区")}else e.toast("请选择地区")},e.touchSetDefault=function(){e.isDefault=!e.isDefault},e.touchPickerShow=function(){e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null,e.showPicker=!0,e.addressEditModel.reloadIfNeeded().then(function(t){t?e.pickerData=e.addressEditModel.regions:(e.toast("请稍后再试"),e.touchPickerCancel())})},e.touchPickerRegion=function(t){e.pickerRegions.push(t),e.pickerRegionName=u(e.pickerRegions),t.regions&&t.regions.length?e.pickerData=t.regions:(e.regions=e.pickerRegions,e.showPicker=!1)},e.touchPickerCancel=function(){e.showPicker=!1,e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null},e.formatRegions=u,e.touchDelete=function(){var t={};t.consignee=e.addressEditModel.consignee.id,o.consignee.delete(t).then(function(t){t?(e.toast("删除成功"),e.goBack()):e.toast("删除失败")})},e.touchCancel=function(){e.goBack()},e.showPicker=!1,e.allowSave=!0,e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null,e.addressEditModel=s;var l=e.addressEditModel.consignee;l&&l.id&&(e.name=l.name,e.mobile=l.mobile,e.regions=l.regions,e.address=l.address,e.isDefault=l.is_default)}angular.module("app").controller("AddressEditController",e),e.$inject=["$scope","$http","API","$location","$q","$window","$state","$stateParams","AddressEditModel"]}(),function(){"use strict";function e(e,t){e.state("address-edit",{needAuth:!0,url:"/address-edit",title:"收货地址",templateUrl:"modules/address-edit/address-edit.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.orders=null,u.fetch=function(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.order.list(o).then(function(e){n.orders=n.orders?n.orders.concat(e):e,n.isEmpty=!n.orders||!n.orders.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(e&&e.length<t)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.orders=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.orders&&this.orders.length?this.fetch(this.orders.length/s+1,s):this.fetch(1,s)))},u}angular.module("app").factory("MyOrderModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d){e.TAB_ALL=0,e.TAB_CREATED=1,e.TAB_PAID=2,e.TAB_DELIVERING=3,e.TAB_DELIVERIED=4,e.currentTab=e.TAB_ALL,e.cancellingOrder=null,e.showDialog=!1,e.myOrderModel=l,e.paymentModel=u,e.orderExpressModel=d,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null):"created"==a.tab?(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=s.ORDER_STATUS.CREATED):"paid"==a.tab?(e.currentTab=e.TAB_PAID,e.myOrderModel.status=s.ORDER_STATUS.PAID):"delivering"==a.tab?(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=s.ORDER_STATUS.DELIVERING):"delivered"==a.tab?(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=s.ORDER_STATUS.DELIVERIED):(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null),e.touchTabAll=function(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null,e.myOrderModel.reload())},e.touchTabCreated=function(){e.currentTab!=e.TAB_CREATED&&(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=s.ORDER_STATUS.CREATED,e.myOrderModel.reload())},e.touchTabPaid=function(){e.currentTab!=e.TAB_PAID&&(e.currentTab=e.TAB_PAID,e.myOrderModel.status=s.ORDER_STATUS.PAID,e.myOrderModel.reload())},e.touchTabDelivering=function(){e.currentTab!=e.TAB_DELIVERING&&(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=s.ORDER_STATUS.DELIVERING,e.myOrderModel.reload())},e.touchTabDeliveried=function(){e.currentTab!=e.TAB_DELIVERIED&&(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=s.ORDER_STATUS.DELIVERIED,e.myOrderModel.reload())},e.touchDialogCancel=function(){e.cancellingOrder=null,e.showDialog=!1},e.touchDialogConfirm=function(){c.order.cancel({order:e.cancellingOrder.id,reason:1}).then(function(t){e.myOrderModel.reload(),e.cancellingOrder=null,e.showDialog=!1})},e.touchOrder=function(e){i.go("order-detail",{order:e.id})},e.touchPay=function(t){t&&(e.paymentModel.clear(),e.paymentModel.order=t,i.go("payment",{}))},e.touchCancel=function(t){e.cancellingOrder=t,e.showDialog=!0},e.touchConfirm=function(e){c.order.confirm({order:e.id}).then(function(e){i.go("confirm-delivery",{order:e.id})})},e.touchExpress=function(t){e.orderExpressModel.clear(),e.orderExpressModel.order=t,i.go("order-express",{order:t.id})},e.touchComment=function(e){i.go("order-review",{order:e.id})},e.myOrderModel.reload()}angular.module("app").controller("MyOrderController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyOrderModel","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("my-order",{needAuth:!0,url:"/my-order?tab",title:"我的订单",templateUrl:"modules/my-order/my-order.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){function d(){e.isLoading=!0,e.isLoaded=!1,c.order.get({order:p}).then(function(t){e.order=t;var o=t.promos;e.promos=[];for(var n in o)"score"==o[n].promo?o[n].name="积分":"cashgift"==o[n].promo?o[n].name="红包":"preferential"==o[n].promo?o[n].name="优惠金额":"goods_reduction"==o[n].promo?o[n].name="商品减免":"order_reduction"==o[n].promo?o[n].name="订单减免":"coupon_reduction"==o[n].promo&&(o[n].name="优惠券减免");e.promos=o,e.isLoading=!1,e.isLoaded=!0})}var p=a.order;e.order={id:p},e.isLoading=!1,e.isLoaded=!1,e.touchPay=function(){e.order&&(e.paymentModel.clear(),e.paymentModel.order=e.order,i.go("payment",{}))},e.touchCancel=function(){e.order&&(e.showDialog=!0)},e.touchConfirm=function(){c.order.confirm({order:p}).then(function(t){e.toast("确认成功"),d()})},e.touchExpress=function(){e.orderExpressModel.clear(),e.orderExpressModel.order=e.order,i.go("order-express",{order:e.order.id})},e.touchComment=function(){i.go("order-review",{order:e.order.id})},e.touchProduct=function(e){i.go("product",{product:e.id})},e.showDialog=!1,e.touchDialogCancel=function(){e.showDialog=!1},e.touchDialogConfirm=function(){c.order.cancel({order:p,reason:1}).then(function(t){e.toast("取消成功"),e.showDialog=!1,d()})},e.paymentModel=u,e.orderExpressModel=l,d()}angular.module("app").controller("OrderDetailController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("order-detail",{needAuth:!0,url:"/order-detail/?order",title:"订单详情",templateUrl:"modules/order-detail/order-detail.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){var u=a.order;e.order={id:u},e.isLoading=!1,e.isLoaded=!1,e.isAnonymous=0,e.touchGood=function(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.GOOD,e.review.content||(e.review.content="")},e.touchMedium=function(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.MEDIUM,e.review.content||(e.review.content="")},e.touchBad=function(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.BAD,e.review.content||(e.review.content="")},e.touchSetAnonymous=function(){e.isAnonymous=!e.isAnonymous},e.touchSubmit=function(){for(var t=[],o=0;o<e.order.goods.length;o++){var n=e.order.goods[o];if(n.review){if(!n.review.grade)return void e.toast("请选择评价");t.push(n.review)}}if(t.length<e.order.goods.length)e.toast("请评价全部商品");else{var r={};r.order=u,r.review=JSON.stringify(t),e.isAnonymous?r.is_anonymous=1:r.is_anonymous=0,c.order.review(r).then(function(t){t&&i.go("review-success",{order:e.order.id})})}},e.isLoading=!0,e.isLoaded=!1,c.order.get({order:u}).then(function(t){e.order=t,e.isLoading=!1,e.isLoaded=!0})}angular.module("app").controller("OrderReviewController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("order-review",{needAuth:!0,url:"/order-review?order",title:"订单评价",templateUrl:"modules/order-review/order-review.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.order=null,s.info=null,s.clear=function(){this.order=null,this.info=null},s.reload=function(){var e=this;return a.shipping.statusGet({order_id:this.order.id,tracking_no:null}).then(function(t){return e.info=t,!!t})},s}angular.module("app").factory("OrderExpressModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.orderExpressModel=u,e.orderExpressModel.reload()}angular.module("app").controller("OrderExpressController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("order-express",{needAuth:!0,url:"/order-express/?order",title:"物流信息",templateUrl:"modules/order-express/order-express.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){var a=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname);if(i.getReferences())var c=parseInt(i.getReferences()),s=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_userinfo&invite_code="+c+"&referer="+a;else s=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_userinfo&referer="+a;o.location.href=s}angular.module("app").controller("WeChatAuthController",e),e.$inject=["$scope","$http","$window","$location","$timeout","AppAuthenticationService"]}(),function(){"use strict";function e(e,t){e.state("wechat-auth",{needAuth:!1,url:"/wechat-auth",title:"微信登录",controller:"WeChatAuthController",templateUrl:"modules/wechat-auth/wechat-auth.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){var d=a.order;if(d){o.$on("onPaySuccess",function(e,t){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(e,t){r.go("payment-failed",{order:d,reason:"微信支付失败"})});var p=l.getConfig()["wxpay.web"];p?(wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:p.app_id,timestamp:p.timestamp,nonceStr:p.nonceStr,signature:p.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){c.pay(d).then(function(e){})}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(e))})):r.go("payment-failed",{order:d,reason:"配置错误"})}else r.go("payment-failed",{order:d,reason:"参数错误"})}angular.module("app").controller("WeChatPayController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","WeixinService","API","ENUM","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("wechat-pay",{needAuth:!0,url:"/wechat-pay?order",title:"微信支付",controller:"WeChatPayController",templateUrl:"modules/wechat-pay/wechat-pay.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_base&referer="+i;o.location.href=a}angular.module("app").controller("WeChatAuthBaseController",e),e.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function e(e,t){e.state("wechat-authbase",{needAuth:!1,url:"/wechat-authbase",title:"微信登录",controller:"WeChatAuthBaseController",templateUrl:"modules/wechat-authbase/wechat-authbase.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){e.paymentModel=c;var d=a.order;if(d){o.$on("onPaySuccess",function(e,t){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(e,t){r.go("payment-failed",{order:d,reason:"支付宝支付失败"})});var p=encodeURIComponent(n.location.protocol+"//"+n.location.host+n.location.pathname),h={order:d,code:"alipay.wap",referer:p};s.payment.pay(h).then(function(t){return t.data.alipay&&t.data.alipay.html&&(e.alipay_html=u.trustAsHtml(t.data.alipay.html)),!0})}else r.go("payment-failed",{order:d,reason:"参数错误"})}angular.module("app").controller("AliPayWapController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","PaymentModel","API","$sce","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("alipay-wap",{needAuth:!0,url:"/alipay-wap?order",title:"微信支付",controller:"AliPayWapController",templateUrl:"modules/alipay-wap/alipay-wap.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.isEmpty=!1,s.isLoaded=!1,s.isLoading=!1,s.isLastPage=!1,s.consignees=null,s.reload=function(){if(i.getToken()&&!this.isLoading){this.consignees=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1;var e=this;a.consignee.list({}).then(function(t){e.consignees=t,e.isEmpty=!e.consignees||!e.consignees.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!0})}},s}angular.module("app").factory("MyAddressModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.touchCreate=function(){e.addressEditModel.clear(),e.addressEditModel.consignee=null,i.go("address-edit",{})},e.touchModify=function(t){e.addressEditModel.clear(),e.addressEditModel.consignee=t,i.go("address-edit",{})},e.myAddressModel=u,e.addressEditModel=s,e.touchDefaultAddress=function(t){a.consignee.setDefault({consignee:t.id}).then(function(o){if(o)for(var n=0;n<e.myAddressModel.consignees.length;n++){var r=e.myAddressModel.consignees[n];r.id==t.id?r.is_default=!0:r.is_default=!1}else e.toast("设置失败")})},e.isDefaultAddress=function(e){return!!e.is_default},e.myAddressModel.reload()}angular.module("app").controller("MyAddressController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$location","$state","API","ENUM","AddressEditModel","MyAddressModel"]}(),function(){"use strict";function e(e,t){e.state("my-address",{needAuth:!0,url:"/my-address",title:"地址管理",templateUrl:"modules/my-address/my-address.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.products=null,u.fetch=function(e,t){this.isLoading=!0;var o=this;a.product.likedList({page:e,per_page:t}).then(function(e){o.products=o.products?o.products.concat(e):e,o.isEmpty=!o.products||!o.products.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(e&&e.length<t)&&!o.isEmpty})},u.reload=function(){i.getToken()&&(this.isLoading||(this.products=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s)))},u.loadMore=function(){this.isLoading||this.isLastPage||(this.products&&this.products.length?this.fetch(this.products.length/s+1,s):this.fetch(1,s))},u.delete=function(e){if(i.getToken()){var t=this;a.product.unlike({product:e}).then(function(e){t.reload()})}},u}angular.module("app").factory("MyFavoriteModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r){e.myFavoriteModel=r,e.touchProduct=function(e){t.go("product",{product:e.id})},e.touchDelete=function(t){e.myFavoriteModel.delete(t.id)},e.myFavoriteModel.reload()}angular.module("app").controller("MyFavoriteController",e),e.$inject=["$scope","$state","API","ENUM","MyFavoriteModel"]}(),function(){"use strict";function e(e,t){e.state("my-favorite",{needAuth:!0,url:"/my-favorite",title:"我的收藏",templateUrl:"modules/my-favorite/my-favorite.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.cashgifts=null,u.fetch=function(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};o.status=this.status;var n=this;a.cashgift.list(o).then(function(e){n.cashgifts=n.cashgifts?n.cashgifts.concat(e):e,n.isEmpty=!n.cashgifts||!n.cashgifts.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(e&&e.length<t)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/s+1,s):this.fetch(1,s)))},u}angular.module("app").factory("MyCashgiftModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){e.TAB_AVAILABLE=0,e.TAB_EXPIRED=1,e.TAB_USED=2,e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel=i,"available"==n.tab?(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE):"expired"==n.tab?(e.currentTab=e.TAB_EXPIRED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED):"used"==n.tab?(e.currentTab=e.TAB_USED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.USED):(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE),e.touchTabAvailable=function(){e.currentTab!=e.TAB_AVAILABLE&&(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE,e.myCashgiftModel.reload())},e.touchTabExpired=function(){e.currentTab!=e.TAB_EXPIRED&&(e.currentTab=e.TAB_EXPIRED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED,e.myCashgiftModel.reload())},e.touchTabUsed=function(){e.currentTab!=e.TAB_USED&&(e.currentTab=e.TAB_USED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.USED,e.myCashgiftModel.reload())},e.myCashgiftModel.reload()}angular.module("app").controller("MyCashgiftController",e),e.$inject=["$scope","$http","$location","$stateParams","$state","MyCashgiftModel","ENUM"]}(),function(){"use strict";function e(e,t){e.state("my-cashgift",{needAuth:!0,url:"/my-cashgift",title:"我的红包",templateUrl:"modules/my-cashgift/my-cashgift.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.score=null,u.rule=null,u.history=null,u.count=function(){if(i.getToken()){var e=this;a.score.get({}).then(function(t){e.score=t.score,e.rule=t.rule})}},u.fetch=function(e,t){this.isLoading=!0;var o=this,n={page:e,per_page:t};this.status&&(n.status=this.status),a.score.historyList(n).then(function(e){o.history=o.history?o.history.concat(e):e,o.isEmpty=!o.history||!o.history.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(e&&e.length<t)&&!o.isEmpty})},u.reload=function(){i.getToken()&&(this.isLoading||(this.history=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.history&&this.history.length?this.fetch(this.history.length/s+1,s):this.fetch(1,s)))},u}angular.module("app").factory("MyScoreModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){e.TAB_ALL=0,e.TAB_INCOME=1,e.TAB_EXPENDITURE=2,e.currentTab=e.TAB_ALL,e.myScoreModel=l,e.paymentModel=u,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null):"income"==a.tab?(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=s.SCORE_STATUS.INCOME):"expenditure"==a.tab?(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=s.SCORE_STATUS.EXPENDITURE):(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null),e.touchTabAll=function(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null,e.myScoreModel.reload())},e.touchTabIncome=function(){e.currentTab!=e.TAB_INCOME&&(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=s.SCORE_STATUS.INCOME,e.myScoreModel.reload())},e.touchTabExpenditure=function(){e.currentTab!=e.TAB_EXPENDITURE&&(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=s.SCORE_STATUS.EXPENDITURE,e.myScoreModel.reload())},e.myScoreModel.count(),e.myScoreModel.reload()}angular.module("app").controller("MyScoreController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyScoreModel"]}(),function(){"use strict";function e(e,t){e.state("my-score",{needAuth:!0,url:"/my-score?tab",title:"我的积分",templateUrl:"modules/my-score/my-score.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){function i(){if(!e.loading){var t={};s=1,t=a?{page:s,per_page:c,id:a}:{page:s,per_page:c,id:0},n.article.list(t).then(function(t){t&&(e.articles=t.articles,e.loading=!1,e.loaded=!0,e.more=parseInt(t.paged.more))})}}e.touchArticle=function(e){e.url?r.location.href=e.url:t.go("article",{id:e.id,title:e.title})},e.articles=[];var a=o.id;o.title?e.title=o.title:e.title="使用帮助",e.loading=!1,e.loaded=!1,e.more=!0;var c=10,s=1;e.reload=i,e.loadMore=function(){if(!e.loading){var t={};t=a?{page:s,per_page:c,id:a}:{page:s,per_page:c,id:0},n.article.list(t).then(function(t){t&&(e.articles=e.articles.concat(t.articles),e.loading=!1,e.loaded=!0,e.more=parseInt(t.paged.more))})}},i()}angular.module("app").controller("ArticleController",e),e.$inject=["$scope","$state","$stateParams","API","$window"]}(),function(){"use strict";function e(e,t){e.state("article",{needAuth:!1,url:"/article?id&title",title:"使用帮助",templateUrl:"modules/article/article.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){r.order;e.reason=r.reason,e.touchToHome=function(){n.go("home",{})}}angular.module("app").controller("ReviewSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("review-success",{needAuth:!0,url:"/review-success?order",title:"评价成功",templateUrl:"modules/review-success/review-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.isDelivery=!0,e.reason=r.reason,e.touchDetail=function(){n.go("order-detail",{order:i})},e.touchComment=function(){n.go("order-review",{order:i})}}angular.module("app").controller("ConfirmDeliveryController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("confirm-delivery",{needAuth:!0,url:"/confirm-delivery?order",title:"交易成功",templateUrl:"modules/confirm-delivery/confirm-delivery.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){e.oldPassword="",e.newPassword="",e.touchChangePassword=function(){var t=e.oldPassword,o=e.newPassword;o==e.newPassword2?i.user.passwordUpdate({old_password:t,password:o}).then(function(t){0==t.data.error_code?(e.toast("密码修改成功"),e.goBack()):e.toast(t.data.error_desc)}):e.toast("两次密码输入不一致")}}angular.module("app").controller("ChangePasswordController",e),e.$inject=["$scope","$http","$window","$location","$state","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("change-password",{needAuth:!0,url:"/change-password",title:"修改密码",templateUrl:"modules/change-password/change-password.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){u.order?(e.selectedType=null,e.paymentModel=u,e.isSelected=function(t){return!!e.selectedType&&t.channel==e.selectedType.channel},e.touchSelect=function(t){e.selectedType=t},e.touchSubmit=function(){if(e.selectedType)switch(e.selectedType.channel){case"chinapay":var t=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:e.paymentModel.order.id,code:"teegon.wap",channel:"chinapay",referer:t};c.payment.pay(o).then(function(e){return e.data.teegon&&e.data.teegon.url&&(l.location.href=e.data.teegon.url),!0});break;case"wxpay":var t=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:e.paymentModel.order.id,code:"teegon.wap",channel:"wxpay_jsapi",referer:t};c.payment.pay(o).then(function(e){return e.data.teegon&&e.data.teegon.url&&(l.location.href=e.data.teegon.url),!0})}else e.toast("请选择支持方式")},e.teegonTypes=[],function(){var t={name:"微信支付",desc:"天工收银微信支付",channel:"wxpay"},o={name:"天工收银银联支付",desc:"天工收银银联支付",channel:"chinapay"};e.teegonTypes.push(o),e.teegonTypes.push(t),e.paymentModel.reload().then(function(e){})}()):i(function(){r.goHome()},1)}angular.module("app").controller("TeegonController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","$window"]}(),function(){"use strict";function e(e,t){e.state("teegon",{needAuth:!1,url:"/teegon",title:"收银台",templateUrl:"modules/teegon/teegon.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=3&referer="+i;o.location.href=a}angular.module("app").controller("QQAuthController",e),e.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function e(e,t){e.state("qq-auth",{needAuth:!1,url:"/qq-auth",title:"QQ登录",controller:"QQAuthController",templateUrl:"modules/qq-auth/qq-auth.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){e.cancellingOrder=null,e.showDialog=!1,e.bonus_amount=0,e.total_bonus=0,e.myBonusModel=u,e.touchDialogCancel=function(){e.cancellingOrder=null,e.showDialog=!1},e.touchDialogConfirm=function(){c.order.cancel({order:e.cancellingOrder.id,reason:1}).then(function(t){e.myOrderModel.reload(),e.cancellingOrder=null,e.showDialog=!1})},e.touchRecommend=function(){i.go("my-recommend",{})},e.touchMyBalance=function(){i.go("my-balance",{})},e.touchRules=function(){i.go("bonus-rule",{})},e.touchCancel=function(t){e.cancellingOrder=t,e.showDialog=!0},e.getBonusStatus=function(e){return e==s.BONUS_STATUS.WAIT?"审核中":e==s.BONUS_STATUS.FINISH?"已分成":e==s.BONUS_STATUS.CANCEL?"已取消":e==s.BONUS_STATUS.REVOKE?"已撤销":""},e.getBonusType=function(e){return e==s.BONUS_TYPE.SIGNUP?"注册分成":"订单分成"},e.myBonusModel.reload()}angular.module("app").controller("BonusController",e),e.$inject=["$scope","$rootScope","$window","$timeout","$location","$state","$stateParams","API","ENUM","BonusModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("bonus",{needAuth:!0,url:"/bonus",title:"我的订单",templateUrl:"modules/bonus/bonus.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.fetch=function(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.bonus.list(o).then(function(e){return n.bonuses=n.bonuses?n.bonuses.concat(e):e,n.isEmpty=!n.bonuses||!n.bonuses.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(e&&e.length<t)&&!n.isEmpty,!0})}},u.getInfo=function(){if(i.getToken()){var e={},t=this;a.bonus.get(e).then(function(e){return t.bonus_info=e,!0})}},u.reload=function(){if(i.getToken()&&!this.isLoading)return this.bonuses=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s),this.getInfo()},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.bonuses&&this.bonuses.length?this.fetch(this.bonuses.length/s+1,s):this.fetch(1,s)))},u.bonuses=[],u}angular.module("app").factory("BonusModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){e.touchBalanceDetail=function(){r.go("balance-history",{})},e.touchWithDrawHistory=function(){r.go("withdraw-history",{})},e.touchWithDraw=function(){e.showDialog=!0},e.touchDialogCancel=function(){e.showDialog=!1,e.input.memo="",e.input.withdraw=""},e.touchDialogConfirm=function(){var t=parseFloat(e.input.withdraw);if(isNaN(t))e.toast("请输入数字");else if(t<=0)e.toast("金额不能小于零");else if(t>parseFloat(e.balanceModel.balanceAmount))e.toast("金额超出提现范围");else if(0!=e.input.memo.length){var o={};o.cash=t,o.memo=e.input.memo,a.withdraw.submit(o).then(function(t){e.balanceModel.reload(),e.cancellingOrder=null,e.showDialog=!1,r.go("withdraw-success",{withdraw:t.cash,member_memo:t.member_memo})})}else e.toast("Memo不能为空")},e.touchWithDrawAll=function(){e.input.withdraw=parseFloat(e.balanceModel.balanceAmount)},e.balanceModel=c,e.input={withdraw:"",memo:""},e.balanceModel.reload()}angular.module("app").controller("MyBalanceController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","BalanceModel"]}(),function(){"use strict";function e(e,t){e.state("my-balance",{needAuth:!0,url:"/my-balance",title:"可用资金",templateUrl:"modules/my-balance/my-balance.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.fetch=function(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.balance.list(o).then(function(e){n.balances=n.balances?n.balances.concat(e):e,n.isEmpty=!n.balances||!n.balances.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(e&&e.length<t)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.balances=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s),this.get()))},u.get=function(){if(i.getToken()){var e={},t=this;a.balance.get(e).then(function(e){t.balanceAmount=e})}},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.balances&&this.balances.length?this.fetch(this.balances.length/s+1,s):this.fetch(1,s)))},u.balances=[],u.balanceAmount=0,u}angular.module("app").factory("BalanceModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.TAB_ALL=0,e.TAB_INCOME=1,e.TAB_EXPENDITURE=2,e.currentTab=e.TAB_ALL,e.myBalanceModel=u,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null):"income"==a.tab?(e.currentTab=e.TAB_INCOME,e.myBalanceModel.status=s.BALANCE_STATUS.IN):"expenditure"==a.tab?(e.currentTab=e.TAB_EXPENDITURE,e.myBalanceModel.status=s.BALANCE_STATUS.OUT):(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null),e.touchTabAll=function(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null,e.myBalanceModel.reload())},e.touchTabIncome=function(){e.currentTab!=e.TAB_INCOME&&(e.currentTab=e.TAB_INCOME,e.myBalanceModel.status=s.BALANCE_STATUS.IN,e.myBalanceModel.reload())},e.touchTabExpenditure=function(){e.currentTab!=e.TAB_EXPENDITURE&&(e.currentTab=e.TAB_EXPENDITURE,e.myBalanceModel.status=s.BALANCE_STATUS.OUT,e.myBalanceModel.reload())},e.myBalanceModel.reload()}angular.module("app").controller("BalanceHistoryController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","BalanceModel"]}(),function(){"use strict";function e(e,t){e.state("balance-history",{needAuth:!0,url:"/balance-history",title:"资金明细",templateUrl:"modules/balance-history/balance-history.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.cancellingWithDraw=null,e.showDialog=!1,e.withDrawHistoryModel=u,e.touchDialogCancel=function(){e.cancellingWithDraw=null,e.showDialog=!1},e.touchDialogConfirm=function(){c.withdraw.cancel({id:e.cancellingWithDraw.id}).then(function(t){e.withDrawHistoryModel.reload(),e.cancellingWithDraw=null,e.showDialog=!1})},e.touchCancel=function(t){e.cancellingWithDraw=t,e.showDialog=!0},e.withDrawHistoryModel.reload()}angular.module("app").controller("WithDrawHistoryController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","WithDrawHistoryModel"]}(),function(){"use strict";function e(e,t){e.state("withdraw-history",{needAuth:!0,url:"/withdraw-history",title:"提现记录",templateUrl:"modules/withdraw-history/withdraw-history.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s=10,u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.status=null,u.withdraws=[],u.fetch=function(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.withdraw.list(o).then(function(e){n.withdraws=n.withdraws?n.withdraws.concat(e):e,n.isEmpty=!n.withdraws||!n.withdraws.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(e&&e.length<t)&&!n.isEmpty})}},u.reload=function(){i.getToken()&&(this.isLoading||(this.withdraws=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,s)))},u.loadMore=function(){i.getToken()&&(this.isLoading||this.isLastPage||(this.withdraws&&this.withdraws.length?this.fetch(this.withdraws.length/s+1,s):this.fetch(1,s)))},u}angular.module("app").factory("WithDrawHistoryModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){e.myRecommendModel=c,e.myRecommendModel.reload()}angular.module("app").controller("MyRecommendController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","MyRecommendModel"]}(),function(){"use strict";function e(e,t){e.state("my-recommend",{needAuth:!0,url:"/my-recommend",title:"可用资金",templateUrl:"modules/my-recommend/my-recommend.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.reload=function(){i.getToken()&&this.fetch()},s.fetch=function(){if(i.getToken()){var e=this,t={};a.recommend.bonusInfo(t).then(function(t){e.bonus_info=t})}},s}angular.module("app").factory("MyRecommendModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r){e.withdraw=r.withdraw,e.member_memo=r.member_memo}angular.module("app").controller("WithDrawSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("withdraw-success",{needAuth:!0,url:"/withdraw-success?withdraw&member_memo",title:"提现成功",templateUrl:"modules/withdraw-success/withdraw-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.bonusModel=c,e.bonusModel.bonus_info&&(e.rule_desc=u.trustAsHtml(e.bonusModel.bonus_info.rule_desc)),s.bonus.get().then(function(t){e.rule_desc=u.trustAsHtml(t.rule_desc)})}angular.module("app").controller("BonusRuleController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","BonusModel","API","$sce"]}(),function(){"use strict";function e(e,t){e.state("bonus-rule",{needAuth:!1,url:"/bonus-rule",title:"分成规则",controller:"BonusRuleController",templateUrl:"modules/bonus-rule/bonus-rule.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();